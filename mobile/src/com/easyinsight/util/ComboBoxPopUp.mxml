<?xml version="1.0"?>
<s:Callout xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:s="library://ns.adobe.com/flex/spark"
    creationComplete="onCreation()" horizontalPosition="start"
    verticalPosition="after">
    <fx:Metadata>
        [Event(name="filterChange", type="com.easyinsight.util.FilterChangeEvent")]
    </fx:Metadata>
    <fx:Script><![CDATA[
        import mx.collections.ArrayCollection;
        import mx.events.ItemClickEvent;

        [Bindable]
        private var _dataProvider:ArrayCollection;

        private var _labelField:String;


        private var _labelFunction:Function;


        [Bindable(event="labelFieldChanged")]
        public function get labelField():String {
            return _labelField;
        }

        public function set labelField(value:String):void {
            if (_labelField == value) return;
            _labelField = value;
            dispatchEvent(new Event("labelFieldChanged"));
        }

        [Bindable(event="labelFunctionChanged")]
        public function get labelFunction():Function {
            return _labelFunction;
        }

        public function set labelFunction(value:Function):void {
            if (_labelFunction == value) return;
            _labelFunction = value;
            dispatchEvent(new Event("labelFunctionChanged"));
        }

        private function onItemClick(event:ItemClickEvent):void {
            valueChanged(event.item);
            stage.removeEventListener(MouseEvent.MOUSE_DOWN, onMouseDown);
            dispatchEvent(new FilterChangeEvent(event.item));
            this.close();
        }

        public function set dataProvider(values:ArrayCollection):void {
            _dataProvider = values;
        }

        override protected function commitProperties():void {
            super.commitProperties();

        }

        protected function valueChanged(newValue:Object):void {
        }

        protected function onWindowCreation():void {
        }

        private function onCreation():void {
            list.addEventListener(ItemClickEvent.ITEM_CLICK, onItemClick);
            stage.addEventListener(MouseEvent.MOUSE_DOWN, onMouseDown, false, 0, true);
            onWindowCreation();
        }

        private function onMouseDown(event:MouseEvent):void {
            var result:Boolean = hitTestPoint(event.stageX, event.stageY);
            if (!result) {
                if (!result) {
                    stage.removeEventListener(MouseEvent.MOUSE_DOWN, onMouseDown);
                    this.close();
                }
            }
        }
        ]]></fx:Script>
    <s:List dataProvider="{_dataProvider}" itemRenderer="com.easyinsight.reportviews.FilterListEntry" maxHeight="400" width="300" id="list"
            labelField="{labelField}" labelFunction="{labelFunction}"/>
</s:Callout>
