<project default="jdbcsolution" basedir="." name="JDBCSolution">
    <property file="../../../build/local.build.properties"/>
    <taskdef resource="flexTasks.tasks" classpath="${flex.sdk.dir}/ant/lib/flexTasks.jar"/>
    <property name="FLEX_HOME" value="${flex.sdk.dir}"/>

    <property name="jdbc.out.path" value="../out/jdbc"/>
    <property name="jdbc.archive.path" value="${jdbc.out.path}/jdbc"/>

    <target name="clean">
        <delete dir="${jdbc.out.path}"/>
        <delete dir="${jdbc.archive.path}"/>
    </target>

    <target name="buildFlex">
         <mxmlc file="../flex/src/DBAdmin.mxml" output="../web2/DatabaseAdmin.swf"
               static-rsls="true">
            <load-config filename="../flex/compiler-config.xml"/>
        </mxmlc>
    </target>

    <target name="copyWeb">
        <mkdir dir="${jdbc.out.path}/web2"/>
        <mkdir dir="${jdbc.out.path}/bin"/>
        <copy flatten="false" todir="${jdbc.out.path}/web2">
            <fileset dir="../web2">
                <include name="**/*"/>
            </fileset>
        </copy>
        <copy flatten="false" todir="${jdbc.out.path}/bin">
            <fileset dir="../bin">
                <include name="cpappend.bat"/>
                <include name="config.properties"/>
                <include name="shutdown.bat"/>
                <include name="startup.bat"/>
                <include name="startup.sh"/>
                <include name="configure.bat"/>
                <include name="configure.sh"/>
            </fileset>
        </copy>
    </target>

    <target name="copyWarContents">
        <mkdir dir="${jdbc.out.path}/web3"/>
        <copy flatten="false" todir="${jdbc.out.path}">
            <fileset dir="../web3">
                <include name="**/*"/>
            </fileset>
        </copy>
    </target>

    <target name="jdbcwar" depends="clean, compileJava, buildFlex, copyLibsWar, copyWarContents">
        <war destfile="../out/dbsolution.war" basedir="${jdbc.out.path}" webxml="${jdbc.out.path}/WEB-INF/web.xml"/>
    </target>

    <target name="copyLibs">
        <copy flatten="true" todir="${jdbc.out.path}/lib">
            <fileset dir="../lib">
                <include name="**/*"/>
            </fileset>
        </copy>
    </target>

    <target name="copyLibsWar">
        <mkdir dir="${jdbc.out.path}/WEB-INF/lib"/>
        <copy todir="${jdbc.out.path}/WEB-INF/lib" >
            <fileset dir="${jdbc.out.path}/lib">
                <include name="**/*"/>
            </fileset>
        </copy>
        <copy flatten="true" todir="${jdbc.out.path}/WEB-INF/lib">
            <fileset dir="../lib">
                <include name="**/*"/>
            </fileset>
        </copy>
    </target>

    <target name="jdbcsolution" depends="clean, compileJava, buildFlex, copyLibs, copyWeb">
        <zip destfile="../out/dbsolution.zip" basedir="${jdbc.out.path}"/>
    </target>

    <target name="compileJava">
        <mkdir dir="${jdbc.out.path}"/>
        <mkdir dir="${jdbc.out.path}/lib"/>
        <mkdir dir="${jdbc.archive.path}"/>
        <javac destdir="${jdbc.archive.path}"
               optimize="off"
               debug="on" failonerror="false"
               srcdir="../src"
               excludes="**/*.smap">
            <classpath>
                <fileset dir="../lib">
                    <include name="*.jar"/>
                </fileset>
            </classpath>
            <include name="**"/>
            <exclude name="tags/**"/>
        </javac>
        <jar destfile="${jdbc.out.path}/lib/jdbc.jar" baseDir="${jdbc.archive.path}"/>
    </target>
</project>