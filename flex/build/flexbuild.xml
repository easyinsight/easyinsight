<project default="compileFlex" basedir="." name="Flex Build">
    <property file="local.build.properties"/>
    <taskdef resource="flexTasks.tasks" classpath="${flex.sdk.dir}/ant/lib/flexTasks.jar"/>

    <property name="FLEX_HOME" value="${flex.sdk.dir}"/>

    <target name="compileFlex">
        <mxmlc file="../src/PrimaryWorkspace.mxml" output="${deployment.path}/PrimaryWorkspace.swf"
               static-rsls="true" incremental="true">
            <load-config filename="../flex-config.xml"/>
        </mxmlc>
    </target>

    <target name="compileCoreSWC">
        <compc output="../libs/rsl/tmp/EICore.swc">
            <load-config filename="../swc-optimized-config.xml"/>
            <source-path path-element="../swc/core"/>
            <include-sources dir="../swc/core" includes="*"/>
            <runtime-shared-library-path path-element="${FLEX_HOME}/frameworks/libs/framework.swc">
                <url rsl-url="framework_3.5.0.12683.swz"/>
                <url rsl-url="framework_3.5.0.12683.swf"/>
            </runtime-shared-library-path>

            <runtime-shared-library-path path-element="${FLEX_HOME}/frameworks/libs/datavisualization.swc">
                <url rsl-url="datavisualization_3.5.0.12683.swz"/>
                <url rsl-url="datavisualization_3.5.0.12683.swf"/>
            </runtime-shared-library-path>

            <runtime-shared-library-path path-element="${FLEX_HOME}/frameworks/libs/rpc.swc">
                <url rsl-url="rpc_3.5.0.12683.swz"/>
                <url rsl-url="rpc_3.5.0.12683.swf"/>
            </runtime-shared-library-path>
        </compc>
        <unzip src="../libs/rsl/tmp/EICore.swc" dest="../libs/rsl/tmp"/>
        <move file="../libs/rsl/tmp/library.swf" tofile="../libs/rsl/tmp/EICore.swf"/>
        <copy file="../libs/rsl/tmp/EICore.swf" todir="${deployment.path}"/>
        <copy file="../libs/rsl/tmp/EICore.swc" todir="../libs/rsl"/>
        <delete dir="../libs/rsl/tmp"/>
    </target>

    <target name="compileFlexOptimized">
        <buildSWF mainMXML="PrimaryWorkspace.mxml" swfName="PrimaryWorkspace" buildFile="core-optimized-config.xml"/>
    </target>

    <macrodef name="buildSWF">
        <attribute name="mainMXML"/>
        <attribute name="swfName"/>
        <attribute name="buildFile"/>
        <sequential>
            <mxmlc file="../src/@{mainMXML}" output="${deployment.path}/@{swfName}.swf" keep-generated-actionscript="false"
                   static-rsls="false" target-player="10.0.0" actionscript-file-encoding="utf8" incremental="false">
                <load-config filename="../@{buildFile}"/>
                <runtime-shared-library-path path-element="${FLEX_HOME}/frameworks/libs/framework.swc">
                    <url rsl-url="framework_3.5.0.12683.swz"/>
                    <url rsl-url="framework_3.5.0.12683.swf"/>
                </runtime-shared-library-path>

                <runtime-shared-library-path path-element="${FLEX_HOME}/frameworks/libs/datavisualization.swc">
                    <url rsl-url="datavisualization_3.5.0.12683.swz"/>
                    <url rsl-url="datavisualization_3.5.0.12683.swf"/>
                </runtime-shared-library-path>

                <runtime-shared-library-path path-element="${FLEX_HOME}/frameworks/libs/rpc.swc">
                    <url rsl-url="rpc_3.5.0.12683.swz"/>
                    <url rsl-url="rpc_3.5.0.12683.swf"/>
                </runtime-shared-library-path>
                <runtime-shared-library-path path-element="../libs/rsl/EICore.swc">
                    <url rsl-url="https://localhost:4443/app/1/EICore.swf"/>
                </runtime-shared-library-path>
            </mxmlc>
        </sequential>
    </macrodef>

    <target name="modules1" depends="report.area3dchart, report.areachart, report.bar3dchart, report.barchart, report.bubblechart"/>
    <target name="modules2" depends="report.column3dchart, report.columnchart, report.linechart, report.line3dchart, report.list"/>
    <target name="modules3" depends="report.pie3dchart, report.piechart, report.plotchart"/>
    <target name="modules4" depends="report.gauge, report.crosstab, report.tree, report.treemap"/>
    <target name="modules5" depends="report.worldmap, report.usmap, report.americasmap, report.asiamap, report.europemap, report.middleeastmap"/>
    <target name="modules6" depends="perspective.spreadsheetwizard, perspective.connectiondetail, perspective.kpitreeadmin, perspective.groupdetail"/>
    <target name="modules7" depends="perspective.kpiwindow, perspective.kpitreeview, perspective.datasourceadmin, perspective.analysisitemeditor"/>
    <target name="modules8" depends="report.africamap"/>

    <target name="perspective.spreadsheetwizard">
        <buildSWF mainMXML="com/easyinsight/customupload/wizard/SpreadsheetWizard.mxml" swfName="SpreadsheetWizard" buildFile="perspectives/spreadsheet-wizard-module.xml"/>
    </target>

    <target name="perspective.connectiondetail">
        <buildSWF mainMXML="com/easyinsight/solutions/ConnectionDetail.mxml" swfName="ConnectionDetail" buildFile="perspectives/connection-detail-module.xml"/>
    </target>

    <target name="perspective.kpitreeadmin">
        <buildSWF mainMXML="com/easyinsight/goals/GoalTreeAdminContainer.mxml" swfName="KPITreeAdmin" buildFile="perspectives/kpitree-admin-module.xml"/>
    </target>

    <target name="perspective.groupdetail">
        <buildSWF mainMXML="com/easyinsight/groups/GroupDetail.mxml" swfName="GroupDetail" buildFile="perspectives/group-detail-module.xml"/>
    </target>

    <target name="perspective.analysisitemeditor">
        <buildSWF mainMXML="com/easyinsight/analysis/AnalysisItemEditor.mxml" swfName="AnalysisItemEditor" buildFile="perspectives/analysis-item-editor-module.xml"/>
    </target>

    <target name="perspective.kpiwindow">
        <buildSWF mainMXML="com/easyinsight/kpi/KPIModule.mxml" swfName="KPIModule" buildFile="perspectives/kpi-window-module.xml"/>
    </target>

    <target name="perspective.kpitreeview">
        <buildSWF mainMXML="com/easyinsight/goals/GoalTreeViewContainer.mxml" swfName="KPITreeView" buildFile="perspectives/kpitree-view-module.xml"/>
    </target>

    <target name="perspective.datasourceadmin">
        <buildSWF mainMXML="com/easyinsight/administration/feed/FeedAdministrationContainer.mxml" swfName="DataSourceAdmin" buildFile="perspectives/datasource-admin-module.xml"/>
    </target>

    <target name="app.embeddedreport">
        <buildSWF mainMXML="EmbeddedInsight.mxml" swfName="EmbeddedInsight" buildFile="embedded-insight.xml"/>
    </target>

    <target name="app.selenium">
        <buildSWF mainMXML="SeleniumReportView.mxml" swfName="SeleniumReportView" buildFile="selenium-report.xml"/>
    </target>

    <target name="app.admin">
        <buildSWF mainMXML="AdministrationApplication.mxml" swfName="AdministrationApplication" buildFile="administration-app.xml"/>
    </target>

    <target name="report.list">
        <buildSWF mainMXML="com/easyinsight/analysis/list/ListModule.mxml" swfName="ListModule" buildFile="modules/list-module.xml"/>
    </target>

    <target name="report.form">
        <buildSWF mainMXML="com/easyinsight/analysis/form/FormModule.mxml" swfName="FormModule" buildFile="modules/form-module.xml"/>
    </target>

    <target name="report.columnchart">
        <buildSWF mainMXML="com/easyinsight/analysis/charts/xaxisbased/column/ColumnChartModule.mxml" swfName="ColumnChartModule" buildFile="modules/column-chart-module.xml"/>
    </target>

    <target name="report.column3dchart">
        <buildSWF mainMXML="com/easyinsight/analysis/charts/xaxisbased/column/Column3DChartModule.mxml" swfName="Column3DChartModule" buildFile="modules/column-3d-chart-module.xml"/>
    </target>

    <target name="report.gantt">
        <buildSWF mainMXML="com/easyinsight/analysis/gantt/GanttModule.mxml" swfName="GanttModule" buildFile="modules/gantt-module.xml"/>
    </target>

    <target name="report.timeline">
        <buildSWF mainMXML="com/easyinsight/analysis/timeline/TimelineModule.mxml" swfName="TimelineModule" buildFile="modules/timeseries-module.xml"/>
    </target>

    <target name="report.piechart">
        <buildSWF mainMXML="com/easyinsight/analysis/charts/xaxisbased/pie/PieChartModule.mxml" swfName="PieChartModule" buildFile="modules/pie-chart-module.xml"/>
    </target>

    <target name="report.pie3dchart">
        <buildSWF mainMXML="com/easyinsight/analysis/charts/xaxisbased/pie/Pie3DChartModule.mxml" swfName="Pie3DChartModule" buildFile="modules/pie-3d-chart-module.xml"/>
    </target>

    <target name="report.barchart">
        <buildSWF mainMXML="com/easyinsight/analysis/charts/yaxisbased/bar/BarChartModule.mxml" swfName="BarChartModule" buildFile="modules/bar-chart-module.xml"/>
    </target>

    <target name="report.bar3dchart">
        <buildSWF mainMXML="com/easyinsight/analysis/charts/yaxisbased/bar/Bar3DChartModule.mxml" swfName="Bar3DChartModule" buildFile="modules/bar-3d-chart-module.xml"/>
    </target>

    <target name="report.areachart">
        <buildSWF mainMXML="com/easyinsight/analysis/charts/twoaxisbased/area/AreaChartModule.mxml" swfName="AreaChartModule" buildFile="modules/area-chart-module.xml"/>
    </target>

    <target name="report.area3dchart">
        <buildSWF mainMXML="com/easyinsight/analysis/charts/twoaxisbased/area/Area3DChartModule.mxml" swfName="Area3DChartModule" buildFile="modules/area-3d-chart-module.xml"/>
    </target>

    <target name="report.linechart">
        <buildSWF mainMXML="com/easyinsight/analysis/charts/twoaxisbased/line/LineChartModule.mxml" swfName="LineChartModule" buildFile="modules/line-chart-module.xml"/>
    </target>

    <target name="report.line3dchart">
        <buildSWF mainMXML="com/easyinsight/analysis/charts/twoaxisbased/line/Line3DChartModule.mxml" swfName="Line3DChartModule" buildFile="modules/line-3d-chart-module.xml"/>
    </target>

    <target name="report.bubblechart">
        <buildSWF mainMXML="com/easyinsight/analysis/charts/bubble/BubbleChartModule.mxml" swfName="BubbleChartModule" buildFile="modules/bubble-chart-module.xml"/>
    </target>

    <target name="report.plotchart">
        <buildSWF mainMXML="com/easyinsight/analysis/charts/plot/PlotChartModule.mxml" swfName="PlotChartModule" buildFile="modules/plot-chart-module.xml"/>
    </target>

    <target name="report.usmap">
        <buildSWF mainMXML="com/easyinsight/analysis/maps/UnitedStatesMapModule.mxml" swfName="UnitedStatesMapModule" buildFile="modules/map-us-module.xml"/>
    </target>

    <target name="report.europemap">
        <buildSWF mainMXML="com/easyinsight/analysis/maps/EuropeMapModule.mxml" swfName="EuropeMapModule" buildFile="modules/map-europe-module.xml"/>
    </target>

    <target name="report.asiamap">
        <buildSWF mainMXML="com/easyinsight/analysis/maps/AsiaMapModule.mxml" swfName="AsiaMapModule" buildFile="modules/map-asia-module.xml"/>
    </target>

    <target name="report.africamap">
        <buildSWF mainMXML="com/easyinsight/analysis/maps/AfricaMapModule.mxml" swfName="AfricaMapModule" buildFile="modules/map-africa-module.xml"/>
    </target>

    <target name="report.worldmap">
        <buildSWF mainMXML="com/easyinsight/analysis/maps/WorldMapModule.mxml" swfName="WorldMapModule" buildFile="modules/map-world-module.xml"/>
    </target>

    <target name="report.americasmap">
        <buildSWF mainMXML="com/easyinsight/analysis/maps/AmericasModule.mxml" swfName="AmericasModule" buildFile="modules/map-americas-module.xml"/>
    </target>

    <target name="report.middleeastmap">
        <buildSWF mainMXML="com/easyinsight/analysis/maps/MiddleEastMapModule.mxml" swfName="MiddleEastMapModule" buildFile="modules/map-middleeast-module.xml"/>
    </target>

    <target name="report.crosstab">
        <buildSWF mainMXML="com/easyinsight/analysis/crosstab/CrosstabModule.mxml" swfName="CrosstabModule" buildFile="modules/crosstab-module.xml"/>
    </target>

    <target name="report.gauge">
        <buildSWF mainMXML="com/easyinsight/analysis/gauge/GaugeModule.mxml" swfName="GaugeModule" buildFile="modules/gauge-module.xml"/>
    </target>

    <target name="report.treemap">
        <buildSWF mainMXML="com/easyinsight/analysis/treemap/TreeMapModule.mxml" swfName="TreeMapModule" buildFile="modules/treemap-module.xml"/>
    </target>

    <target name="report.heatmap">
        <buildSWF mainMXML="com/easyinsight/analysis/heatmap/HeatMapModule.mxml" swfName="HeatMapModule" buildFile="modules/heatmap-module.xml"/>
    </target>

    <target name="report.tree">
        <buildSWF mainMXML="com/easyinsight/analysis/tree/TreeModule.mxml" swfName="TreeModule" buildFile="modules/tree-module.xml"/>
    </target>
</project>