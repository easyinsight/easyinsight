<?xml version="1.0"?>
<util:EISlimWindow xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:util="com.easyinsight.util.*"
        creationComplete="getConfigurations()" horizontalAlign="left">
    <mx:Script><![CDATA[
        import com.easyinsight.report.SavedConfiguration;

        import mx.managers.PopUpManager;

        private var _deliveryInfo:DeliveryInfo;

        public function set deliveryInfo(value:DeliveryInfo):void {
            _deliveryInfo = value;
        }

        private function getConfigurations():void {
            dashboardService.getConfigurationsForDashboard.send(dashboardID);
        }

        private function gotConfigurations():void {
            configurations = dashboardService.getConfigurationsForDashboard.lastResult as ArrayCollection;
            if (configurationComboBox != null) {
                configurationComboBox.selectedValue = configurationID;
            }

            if (configurations.length == 0) {
                configEnabled = false;
            } else {
                configurations.addItemAt({ name: "[ Select a Configuration ]"}, 0);
                configEnabled = true;
            }
        }

        private var dashboardID:int;
        private var deliveryExtension:DeliveryExtension;

        [Bindable]
        private var showHeader:Boolean;

        [Bindable]
        private var orientation:String = "Landscape";

        override protected function commitProperties():void {
            super.commitProperties();
            if (dashboardID != _deliveryInfo.id) {
                dashboardID = _deliveryInfo.id;
                deliveryExtension = _deliveryInfo.deliveryExtension;
                configurationID = _deliveryInfo.configurationID;
                if (deliveryExtension != null) {
                    showHeader = PDFDeliveryExtension(deliveryExtension).showHeader;
                    orientation = PDFDeliveryExtension(deliveryExtension).orientation;
                }

            }
        }

        public function save():void {
            _deliveryInfo.id = dashboardID;
            _deliveryInfo.format = 3;
            if (configurationComboBox.selectedItem is SavedConfiguration) {
                var sc:SavedConfiguration = configurationComboBox.selectedItem as SavedConfiguration;
                _deliveryInfo.configurationID = sc.id;
            } else {
                _deliveryInfo.configurationID = 0;
            }
            var ext:PDFDeliveryExtension = new PDFDeliveryExtension();
            ext.showHeader = showHeaderCheckBox.selected;
            /*ext.width = widthStepper.value;
            ext.height = heightStepper.value;*/
            ext.orientation = orientationBox.selectedItem as String;
            _deliveryInfo.deliveryExtension = ext;
            PopUpManager.removePopUp(this);
        }

        [Bindable]
        private var configurations:ArrayCollection;

        [Bindable]
        private var selectedMode:String;

        [Bindable]
        private var configEnabled:Boolean;

        [Bindable]
        private var configurationID:int;

        [Bindable]
        private var stackIndex:int = 0;
        ]]></mx:Script>
    <mx:RemoteObject id="dashboardService" destination="dashboardService">
        <mx:method name="getConfigurationsForDashboard" result="gotConfigurations()"/>
    </mx:RemoteObject>
    <mx:Form>
        <mx:FormItem label="Show Header:" labelWidth="200">
            <mx:CheckBox id="showHeaderCheckBox" selected="{showHeader}"/>
        </mx:FormItem>
    </mx:Form>
    <mx:Text maxWidth="500" text="To send out a specific page on a dashboard stack or customize the filters used in the PDF, you can save Configurations on the end user view, and then reference back to those customers with the dropdown below."/>
    <mx:Form>
        <mx:FormItem label="Configuration:" id="configurationComboBoxItem" labelWidth="200">
            <util:SmartComboBox dataProvider="{configurations}" selectedValue="{configurationID}" selectedProperty="id"
                                id="configurationComboBox" labelField="name" enabled="{configEnabled}"/>
        </mx:FormItem>
    </mx:Form>
    <mx:Form>
        <mx:FormItem label="Orientation:" labelWidth="200">
            <mx:ComboBox id="orientationBox" selectedItem="{orientation}">
                <mx:dataProvider>
                    <mx:ArrayCollection>
                        <mx:Array>
                            <mx:String>Landscape</mx:String>
                            <mx:String>Portrait</mx:String>
                        </mx:Array>
                    </mx:ArrayCollection>
                </mx:dataProvider>
            </mx:ComboBox>
        </mx:FormItem>
    </mx:Form>
    <mx:HBox width="100%">
        <util:SaveButton label="Save" click="save()"/>
        <util:CancelButton label="Cancel" click="PopUpManager.removePopUp(this)"/>
    </mx:HBox>
</util:EISlimWindow>
