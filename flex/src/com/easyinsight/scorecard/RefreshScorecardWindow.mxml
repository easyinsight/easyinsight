<?xml version="1.0" ?>
<util:EITitleWindow xmlns:util="com.easyinsight.util.*" xmlns:mx="http://www.adobe.com/2006/mxml" title="Refresh Scorecard Values">
    <mx:Script><![CDATA[
        import com.easyinsight.kpi.KPI;
        import com.easyinsight.kpi.KPIOutcome;
        import com.easyinsight.util.ProgressAlert;

        import mx.collections.ArrayCollection;
        import mx.managers.PopUpManager;

        private var _scorecards:ArrayCollection;

        public function set scorecards(value:ArrayCollection):void {
            _scorecards = value;
        }

        public function refreshData():void {
            ProgressAlert.alert(this, "Refreshing the scorecard...", null, scorecardService.refreshValues);
            scorecardService.refreshValues.send(allDataSourcesCheckbox.selected);
        }

        private function gotRefresh():void {
            var kpiValues:ArrayCollection = scorecardService.refreshValues.lastResult as ArrayCollection;
            for each (var kpiValue:KPIOutcome in kpiValues) {
                for each (var scorecard:Scorecard in _scorecards) {
                    var found:Boolean = false;
                    for each (var kpi:KPI in scorecard.kpis) {
                        if (kpi.kpiID == kpiValue.kpiID) {
                            kpi.kpiOutcome = kpiValue;
                            found = true;
                            break;
                        }
                    }
                    if (found) {
                        break;
                    }
                }
            }
            dispatchEvent(new ScorecardRefreshEvent());
            PopUpManager.removePopUp(this);
        }
        ]]></mx:Script>
    <mx:RemoteObject destination="scorecardService" id="scorecardService">
        <mx:method name="refreshValues" result="gotRefresh()"/>
    </mx:RemoteObject>
    <mx:Form styleName="TitleWindowContents">
        <mx:FormItem label="Include All Data Sources:">
            <mx:CheckBox id="allDataSourcesCheckbox"/>
        </mx:FormItem>
        <mx:FormItem label="" direction="horizontal">
            <mx:Button label="Refresh" click="refreshData()"/>
            <mx:LinkButton label="Cancel" textDecoration="underline" click="PopUpManager.removePopUp(this)"/>
        </mx:FormItem>
    </mx:Form>

</util:EITitleWindow>