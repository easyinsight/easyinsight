<?xml version="1.0"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" height="100%" paddingLeft="10" paddingRight="10" paddingTop="10"
                         paddingBottom="10" horizontalAlign="center" verticalScrollPolicy="off">
    <mx:Metadata>
        [Event(name="uiChange", type="flash.events.Event")]
    </mx:Metadata>
    <mx:Script><![CDATA[
        import com.easyinsight.feedassembly.CompositeCreator;
        import com.easyinsight.framework.User;
        import com.easyinsight.genredata.AnalyzeEvent;
        import com.easyinsight.skin.ApplicationSkin;
        import com.easyinsight.skin.HomeConfigWindow;
        import com.easyinsight.util.PopUpUtil;
        import com.easyinsight.util.ProgressAlert;

        import mx.collections.ArrayCollection;

        import mx.managers.PopUpManager;
        import mx.states.RemoveChild;
        import mx.states.State;

        [Bindable]
        [Embed(source="../../../../assets/preferences.png")]
        private var configIcon:Class;

        [Bindable]
        [Embed(source="../../../../assets/earth.png")]
        private var globeIcon:Class;

        [Bindable]
        [Embed(source="../../../../assets/data_table.png")]
        private var joinIcon:Class;

        public function refreshActions():void {
            adminService.getRecentActions.send()
        }

        private function createCompositeFeed():void {
            var descriptors:ArrayCollection = new ArrayCollection();
            var creator:CompositeCreator = new CompositeCreator(this);
            creator.dataSources = descriptors;
            creator.addEventListener(AnalyzeEvent.ANALYZE, onAnalyze, false, 0, true);
            creator.start();
        }

        [Bindable]
        private var recentActions:ArrayCollection;

        private function gotRecentActions():void {
            recentActions = adminService.getRecentActions.lastResult as ArrayCollection;
        }

        public function updateUI(event:Event = null):void {
            currentState = "";
            var showState:State = new State();
            showState.name = "buttonConfig";
            var ops:Array = [];
            /*if (!User.getInstance().analyst) {
                var removeConfig:RemoveChild = new RemoveChild();
                removeConfig.target = customizeButton;
                var removeComposite:RemoveChild = new RemoveChild();
                removeComposite.target = compositeFeedButton;
                ops.push(removeConfig, removeComposite);
            }*/
            showState.overrides = ops;
            states = [ showState ];
            this.currentState = "buttonConfig";
            dispatchEvent(new Event('uiChange'));
        }

        private function onAnalyze(event:AnalyzeEvent):void {
            dispatchEvent(event);
        }



        private function htmlView():void {
            ProgressAlert.alert(this, "Saving preferences...", null, userService.switchHtmlFlex);
            userService.switchHtmlFlex.send(true);
        }

        private static function switched():void {
            navigateToURL(new URLRequest("/app/html"), "_self");
        }
        ]]></mx:Script>
    <mx:RemoteObject id="adminService" destination="admin">
        <mx:method name="getRecentActions" result="gotRecentActions()"/>
    </mx:RemoteObject>
    <mx:RemoteObject id="userService" destination="login">
        <mx:method name="switchHtmlFlex" result="switched()"/>
    </mx:RemoteObject>
        <mx:Label text="Recent Actions" fontSize="16"/>
    <mx:HRule width="50" strokeColor="#CCCCCC"/>
        <mx:List dataProvider="{recentActions}" backgroundAlpha="0" borderStyle="none" height="100%"
                itemRenderer="com.easyinsight.listing.LastActionLink" variableRowHeight="true" verticalScrollPolicy="off" selectable="false"/>
</mx:VBox>
