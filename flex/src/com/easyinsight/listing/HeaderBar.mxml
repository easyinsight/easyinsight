<?xml version="1.0" encoding="utf-8"?>

<mx:HBox xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:local="*" xmlns:listing="com.easyinsight.listing.*"
         width="100%" borderStyle="none" xmlns:easyinsight="com.easyinsight.*" horizontalGap="25" verticalAlign="middle" backgroundColor="0xF0F0F0"
        creationComplete="setup()" addedToStage="onAdded()" removedFromStage="onRemoved()">
    <mx:Metadata>
        [Event(name="triggerAnalyze", type="com.easyinsight.listing.TriggerAnalyzeEvent")]
        [Event(name="listingChange", type="com.easyinsight.listing.ListingChangeEvent")]
        [Event(name="launchQuickSearch", type="com.easyinsight.listing.LaunchQuickSearchEvent")]
        [Event(name="reportBug", type="com.easyinsight.listing.ReportBugEvent")]
    </mx:Metadata>
    <mx:Script>
		<![CDATA[
        import com.easyinsight.framework.LoginEvent;
        import com.easyinsight.framework.NavigationEvent;
        import com.easyinsight.framework.User;
        import com.easyinsight.goals.MyGoals;
        import com.easyinsight.preferences.PreferencesWindow;
        import com.easyinsight.solutions.RevisedSolutionSummary;
        import com.easyinsight.groups.GroupsSummary;
        import com.easyinsight.account.AccountBasePage;
        import com.easyinsight.customupload.api.APIPage;
        import com.easyinsight.genredata.GenreDataProvider;
        import com.easyinsight.intro.IntroPanel;

        import com.easyinsight.util.PopUpUtil;

        import mx.controls.Alert;
        import mx.managers.PopUpManager;

        private function onRemoved():void {
            stage.removeEventListener(KeyboardEvent.KEY_UP, onKey);
        }

        private function onAdded():void {
            stage.addEventListener(KeyboardEvent.KEY_UP, onKey);
        }

        private function showPreferences():void {
            var window:PreferencesWindow = new PreferencesWindow();
            PopUpManager.addPopUp(window, this, true);
            PopUpUtil.centerPopUp(window);
        }

        private function onKey(event:KeyboardEvent):void {            
            if (event.keyCode == Keyboard.F1) {
                User.getEventNotifier().dispatchEvent(new NavigationEvent("Intro"));
            } else if (event.keyCode == Keyboard.F2) {
                User.getEventNotifier().dispatchEvent(new NavigationEvent("My Data"));
            } else if (event.keyCode == Keyboard.F3) {
                User.getEventNotifier().dispatchEvent(new NavigationEvent("Exchange"));
            } else if (event.keyCode == Keyboard.F4) {
                User.getEventNotifier().dispatchEvent(new NavigationEvent("Groups"));
            } else if (event.keyCode == Keyboard.F5) {
                User.getEventNotifier().dispatchEvent(new NavigationEvent("Solutions"));
            } else if (event.keyCode == Keyboard.F6) {
                User.getEventNotifier().dispatchEvent(new NavigationEvent("Goals"));
            } else if (event.keyCode == Keyboard.F7) {
                User.getEventNotifier().dispatchEvent(new NavigationEvent("API"));
            } else if (event.keyCode == Keyboard.F8) {
                User.getEventNotifier().dispatchEvent(new NavigationEvent("Accounts"));
            }
        }

        private function setup():void {
            User.getEventNotifier().addEventListener(LoginEvent.LOGIN, loginEvent);
            User.getEventNotifier().addEventListener(LoginEvent.LOGOUT, loginEvent);

        }

        private function loginEvent(event:LoginEvent):void {
            loggedIn = event.type == LoginEvent.LOGIN;
        }

        [Bindable]
        [Embed(source="../../../../assets/find.png")]
        private var findIcon:Class;

        [Bindable]
        [Embed(source="../../../../assets/preferences.png")]
        private var preferencesIcon:Class;

        [Bindable]
        [Embed(source="../../../../assets/headericons/house.png")]
        private var homeIcon:Class;

        [Bindable]
        [Embed(source="../../../../assets/headericons/chart_area.png")]
        private var myDataIcon:Class;

        [Bindable]
        [Embed(source="../../../../assets/headericons/shopping_bag.png")]
        private var catalogIcon:Class;

        [Bindable]
        [Embed(source="../../../../assets/headericons/users2.png")]
        private var groupsIcon:Class;

        [Bindable]
        [Embed(source="../../../../assets/headericons/components.png")]
        private var solutionsIcon:Class;

        [Bindable]
        [Embed(source="../../../../assets/headericons/branch.png")]
        private var goalsIcon:Class;

        [Bindable]
        [Embed(source="../../../../assets/headericons/user.png")]
        private var accountIcon:Class;

        [Bindable]
        [Embed(source="../../../../assets/headericons/application_enterprise.png")]
        private var apiIcon:Class;

        [Bindable]
        [Embed(source="../../../../assets/headericons/help.png")]
        private var helpIcon:Class;

        [Bindable]
        [Embed(source="../../../../assets/bug_red.png")]
        private var bugIcon:Class;

        [Bindable]
        [Embed(source="../../../../assets/logo2.PNG")]
        private var logo:Class;

        [Bindable]
        private var loggedIn:Boolean = false;

        private function onListingChange(event:ListingChangeEvent):void {
            dispatchEvent(event);
        }

        private function findNode(targetPage:String, items:Array):ListingOption {
            for each (var obj:Object in items) {
                if (obj is ListingOption) {
                    var listingOption:ListingOption = obj as ListingOption;
                    if (listingOption.displayName == targetPage) {
                        return listingOption;
                    }
                }
            }
            return null;
        }

        public function explicitChange(targetPage:String, properties:Object):void {
            var listingOption:ListingOption = findNode(targetPage, getChildren());
            dispatchEvent(new ListingChangeEvent(listingOption.perspective, properties));
        }
		]]>
    </mx:Script>
    <mx:Image source="{logo}"/>
    <mx:Spacer width="10"/>
    <listing:ListingOption perspective="{new IntroPanel()}" enableAnalysis="false" displayName="Intro" listingChange="onListingChange(event)" width="50">
        <mx:Image source="{homeIcon}" id="homeImage"/>
        <mx:Label text="Intro" fontSize="12" fontFamily="Tahoma" fontWeight="bold" color="0x323232"/>
    </listing:ListingOption>
    <listing:ListingOption perspective="{new MyData()}" enableAnalysis="false" displayName="My Data" listingChange="onListingChange(event)" id="myDataOption">
        <mx:Image source="{myDataIcon}" id="myDataImage"/>
        <mx:Label text="My Data" fontSize="12" fontFamily="Tahoma" fontWeight="bold" color="0x323232"/>
    </listing:ListingOption>
    <listing:ListingOption perspective="{new GenreDataProvider()}" enableAnalysis="false" displayName="Exchange" listingChange="onListingChange(event)">
        <mx:Image source="{catalogIcon}" id="catalogImage"/>
        <mx:Label text="Exchange" fontSize="12" fontFamily="Tahoma" fontWeight="bold" color="0x323232"/>
    </listing:ListingOption>
    <listing:ListingOption perspective="{new GroupsSummary()}" enableAnalysis="false" displayName="Groups" listingChange="onListingChange(event)">
        <mx:Image source="{groupsIcon}" id="groupsImage"/>
        <mx:Label text="Groups" fontSize="12" fontFamily="Tahoma" fontWeight="bold" color="0x323232"/>
    </listing:ListingOption>
    <listing:ListingOption perspective="{new RevisedSolutionSummary()}" enableAnalysis="false" displayName="Solutions" listingChange="onListingChange(event)">
        <mx:Image source="{solutionsIcon}" id="solutionsImage"/>
        <mx:Label text="Solutions" fontSize="12" fontFamily="Tahoma" fontWeight="bold" color="0x323232"/>
    </listing:ListingOption>
    <listing:ListingOption perspective="{new MyGoals()}" enableAnalysis="false" displayName="Goals" listingChange="onListingChange(event)">
        <mx:Image source="{goalsIcon}" id="goalsImage"/>
        <mx:Label text="KPIs" fontSize="12" fontFamily="Tahoma" fontWeight="bold" color="0x323232"/>
    </listing:ListingOption>
    <listing:ListingOption perspective="{new APIPage()}" enableAnalysis="false" displayName="API" listingChange="onListingChange(event)">
        <mx:Image source="{apiIcon}" id="apiImage"/>
        <mx:Label text="API" fontSize="12" fontFamily="Tahoma" fontWeight="bold" color="0x323232"/>
    </listing:ListingOption>
    <listing:ListingOption perspective="{new AccountBasePage()}" enableAnalysis="false" displayName="Accounts" listingChange="onListingChange(event)">
        <mx:Image source="{accountIcon}" id="accountImage"/>
        <mx:Label text="Account" fontSize="12" fontFamily="Tahoma" fontWeight="bold" color="0x323232"/>
    </listing:ListingOption>

    <mx:Spacer width="100%"/>

    <mx:Button icon="{preferencesIcon}" click="showPreferences()" toolTip="Preferences" visible="{loggedIn}" />

    <mx:Button icon="{bugIcon}" click="dispatchEvent(new ReportBugEvent())" toolTip="Report Bug" visible="{loggedIn}" />

    <mx:Button icon="{findIcon}" click="dispatchEvent(new LaunchQuickSearchEvent())" toolTip="Search (Ctrl .)" visible="{loggedIn}"/>


        
    <easyinsight:LoginStatusDisplay id="loginStatusDisplay" horizontalAlign="right"/>

</mx:HBox>
