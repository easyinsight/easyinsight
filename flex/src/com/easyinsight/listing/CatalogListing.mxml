<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:util="com.easyinsight.util.*" width="100%" height="100%"
           implements="com.easyinsight.genredata.ICatalogPage"
           doubleClickEnabled="true">
    <mx:Metadata>
        [Event(name="returnToStore", type="com.easyinsight.listing.CatalogNavigationEvent")]
    </mx:Metadata>
    <mx:Script>
		<![CDATA[
        import com.easyinsight.framework.ModuleAnalyzeSource;
        import com.easyinsight.genredata.ModuleAnalyzeEvent;
        import mx.events.ListEvent;
        import mx.collections.ArrayCollection;

        [Bindable]
        public var dataFeeds:ArrayCollection;

        public function analyze():ModuleAnalyzeSource {
            var dataFeedDescriptor:DataFeedDescriptor = null;
            if (dataFeedGrid.selectedItem != null) {
                dataFeedDescriptor = dataFeedGrid.selectedItem as DataFeedDescriptor;
            } else {
                if (dataFeeds.length == 0) {
                    // can't do anything...
                } else {
                    dataFeedDescriptor = dataFeeds.getItemAt(0) as DataFeedDescriptor;
                }
            }
            var analyzeSource:ModuleAnalyzeSource = null;
            if (dataFeedDescriptor != null) {
                analyzeSource = new DescriptorAnalyzeSource(dataFeedDescriptor);
            }
            return analyzeSource;
        }

        private function returnToStore():void {
            dispatchEvent(new CatalogNavigationEvent(CatalogNavigationEvent.RETURN_TO_STORE));
        }

        private function gridDoubleClick(event:ListEvent):void {
            var feedDescriptor:DataFeedDescriptor = event.currentTarget.selectedItem as DataFeedDescriptor;
            dispatchEvent(new ModuleAnalyzeEvent(new DescriptorAnalyzeSource(feedDescriptor)));
        }
		]]>
    </mx:Script>
    <mx:VBox width="100%" height="100%">
        <mx:Button label="Return" click="returnToStore()"/>
        <mx:DataGrid dataProvider="{dataFeeds}" width="100%" height="100%" id="dataFeedGrid" selectable="true"
                     itemDoubleClick="gridDoubleClick(event)">
            <mx:columns>
                <util:EIDataGridColumn headerText="Name" dataField="name"/>
                <util:EIDataGridColumn headerText="Owner" width="120" dataField="ownerName"/>
                <util:EIDataGridColumn headerText="Attribution" width="160" dataField="attribution"/>
                <!--
                <util:EIDataGridColumn headerText="Price" width="90" dataField="name"
                                   itemRenderer="com.easyinsight.listing.PriceRenderer"/>
                                   -->
                <util:EIDataGridColumn headerText="" width="100" dataField="name"
                                   itemRenderer="com.easyinsight.listing.CatalogIconControls"/>
            </mx:columns>
        </mx:DataGrid>
    </mx:VBox>
</mx:Canvas>
