<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:listing="com.easyinsight.listing.*"
         xmlns:util="com.easyinsight.util.*" xmlns:solutions="com.easyinsight.solutions.*" width="100%" height="100%"
         implements="com.easyinsight.listing.IPerspective"
         backgroundColor="#DCE2F8" doubleClickEnabled="true" creationComplete="initListeners()"
         paddingTop="0" paddingLeft="0" paddingRight="0" paddingBottom="0" verticalGap="0">
    <mx:Script>
		<![CDATA[
        import com.easyinsight.framework.LoginEvent;

        import com.easyinsight.help.ScreencastWindow;

        import com.easyinsight.listing.ListingChangeEvent;

        import mx.events.ItemClickEvent;
        import mx.managers.CursorManager;
        import mx.utils.URLUtil;

        import com.easyinsight.framework.User;

        import mx.managers.BrowserManager;
        import mx.events.ListEvent;
        import mx.managers.PopUpManager;
        import mx.collections.ArrayCollection;

        private function onClick(event:ItemClickEvent):void {
            selectedCategory = event.index;
            availableSolutions.refresh();
        }

        [Bindable]
        [Embed(source="../../../../assets/media_play.png")]
        private var pointerIcon:Class;

        private var selectedCategory:int;

        [Bindable]
        private var availableSolutions:ArrayCollection;

        [Bindable]
        private var availableRowCount:int = 5;

        private function initListeners():void {
            User.getEventNotifier().addEventListener(LoginEvent.LOGIN, onLogin);
            addEventListener(SolutionSelectionEvent.SOLUTION_SELECTION, onSelection);
        }

        private function onSelection(event:SolutionSelectionEvent):void {
            var detail:RevisedSolutionDetail = new RevisedSolutionDetail();
            detail.solution = event.solution;
            dispatchEvent(new ListingChangeEvent(detail));
        }

        private function onLogin(event:LoginEvent):void {
            gotFocus();
        }

        public function gotFocus():void {
            var fragmentObject:Object = new Object();
            fragmentObject.page = "solutions";
            BrowserManager.getInstance().setTitle("Easy Insight - Solutions");
            var fragmentString:String = URLUtil.objectToString(fragmentObject);
            BrowserManager.getInstance().setFragment(fragmentString);
            solutionService.getSolutions.send();            
        }

        private function gotAllSolutions():void {
            this.availableSolutions = solutionService.getSolutions.lastResult as ArrayCollection;
            availableSolutions.filterFunction = filterFunction;
        }

        private function search():void {

        }

        private function lesson1():void {
            var window:ScreencastWindow = new ScreencastWindow();
            window.screencastSource = "../assets/lesson1/training.mp4";
            PopUpManager.addPopUp(window, this);
            window.x = 300;
            window.y = 200;
        }

        private function filterFunction(item:Object):Boolean {
            var solution:Solution = item as Solution;
            if (selectedCategory == 0) {
                return true;
            } else {
                return solution.category == selectedCategory;
            }
        }
                        
        ]]>
	</mx:Script>
    <mx:RemoteObject destination="solutionService" id="solutionService">
        <mx:method name="getSolutions" result="gotAllSolutions()"/>
    </mx:RemoteObject>
    <mx:VBox width="100%" height="100%" backgroundColor="#818285" horizontalAlign="center">
        <mx:VBox width="1000" height="100%" id="coreContent" backgroundColor="#FFFFFF" paddingTop="10" paddingLeft="10"
                 paddingRight="10" paddingBottom="10">
            <mx:HBox width="100%" horizontalAlign="center">
                <mx:VBox width="100%" height="100%" horizontalAlign="center">
                    <mx:Box width="100%" height="100%" horizontalAlign="center" verticalAlign="middle">
                        <mx:Label fontSize="24" text="Click one of the solutions below to get started!"/>
                    </mx:Box>
                    <mx:Label text="You can use these buttons to filter down to certain solution types."/>
                    <mx:ButtonBar itemClick="onClick(event)">
                        <mx:dataProvider>
                            <mx:ArrayCollection>
                                <mx:String>All Solutions</mx:String>
                                <mx:String>SaaS Integrations</mx:String>
                                <mx:String>Client Downloads</mx:String>
                                <mx:String>Easy Insight Training</mx:String>
                            </mx:ArrayCollection>
                        </mx:dataProvider>
                    </mx:ButtonBar>
                </mx:VBox>
                <mx:VBox horizontalAlign="center">
                    <mx:Image source="../assets/lesson1/FirstFrame.png" width="256" height="192" click="lesson1()" rollOver="CursorManager.setCursor(pointerIcon);"
                            rollOut="CursorManager.removeAllCursors()"/>
                    <mx:HBox>
                        <mx:Label text="Watch Demo Video" fontSize="14"/>
                    </mx:HBox>
                </mx:VBox>
            </mx:HBox>
            <mx:TileList width="100%" height="100%" itemRenderer="com.easyinsight.solutions.SolutionView" dataProvider="{availableSolutions}" id="solutionGrid"
                    columnWidth="240" rowHeight="160" backgroundColor="#EEEEEE"/>
        </mx:VBox>
    </mx:VBox>
</mx:VBox>
