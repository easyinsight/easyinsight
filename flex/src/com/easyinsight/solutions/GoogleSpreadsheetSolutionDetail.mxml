<?xml version="1.0" ?>
<solutions:SolutionDetailRenderer xmlns:mx="http://www.adobe.com/2006/mxml"
                                  xmlns:solutions="com.easyinsight.solutions.*">
    <mx:Script><![CDATA[
        import com.easyinsight.customupload.UploadConfigEvent;
        import com.easyinsight.genredata.AnalyzeEvent;
        import com.easyinsight.google.GoogleAuthWindow;
        import com.easyinsight.google.GoogleSpreadsheetEvent;
        import com.easyinsight.google.GoogleSpreadsheetResponse;
        import com.easyinsight.google.GoogleWindow;
        import com.easyinsight.listing.DescriptorAnalyzeSource;
        import com.easyinsight.util.PopUpUtil;

        import com.easyinsight.util.ProgressAlert;

        import mx.managers.PopUpManager;


        private function passThrough(event:Event):void {
            //Alert.show("got event at solution level");
            dispatchEvent(event);
        }

        private function gotRequirements():void {
            var response:GoogleSpreadsheetResponse = googleService.getAvailableGoogleSpreadsheets.lastResult as GoogleSpreadsheetResponse;
            if (response.validOAuth) {
                var uploadExternal:GoogleWindow = new GoogleWindow();
                uploadExternal.googleSpreadsheets = response.spreadsheets;
                uploadExternal.addEventListener(AnalyzeEvent.ANALYZE, passThrough);
                uploadExternal.addEventListener(UploadConfigEvent.UPLOAD_CONFIG_COMPLETE, uploadConfigComplete);
                PopUpManager.addPopUp(uploadExternal, this, true);
                PopUpUtil.centerPopUp(uploadExternal);
            } else {
                var window:GoogleAuthWindow = new GoogleAuthWindow();
                window.addEventListener(GoogleSpreadsheetEvent.GOOGLE_SPREADSHEET, onSpreadsheet, false, 0, true);
                PopUpManager.addPopUp(window, this, true);
                PopUpUtil.centerPopUp(window);
            }
        }

        private function initialSetup():void {
            ProgressAlert.alert(this, "Retrieving spreadsheets...", null, googleService.getAvailableGoogleSpreadsheets);
            googleService.getAvailableGoogleSpreadsheets.send();
        }

        private function onSpreadsheet(event:GoogleSpreadsheetEvent):void {
            var uploadExternal:GoogleWindow = new GoogleWindow();
            uploadExternal.googleSpreadsheets = event.spreadsheets;
            uploadExternal.addEventListener(AnalyzeEvent.ANALYZE, passThrough, false, 0, true);
            uploadExternal.addEventListener(UploadConfigEvent.UPLOAD_CONFIG_COMPLETE, uploadConfigComplete, false, 0, true);
            PopUpManager.addPopUp(uploadExternal, this, true);
            PopUpUtil.centerPopUp(uploadExternal);
        }

        private function uploadConfigComplete(event:UploadConfigEvent):void {
            dispatchEvent(new AnalyzeEvent(new DescriptorAnalyzeSource(event.feedID)));
        }
]]></mx:Script>
    <mx:RemoteObject destination="google" id="googleService">
        <mx:method name="getAvailableGoogleSpreadsheets" result="gotRequirements()"/>
    </mx:RemoteObject>
    <mx:HBox width="100%" height="100%" horizontalGap="0">
        <solutions:HeaderShadeArea width="50" height="100%" leftColor="#000000" rightColor="#FFFFFF"/>
        <mx:VBox width="100%" height="100%" styleName="connectionDetailCanvas" horizontalAlign="center">
            <mx:HBox verticalAlign="middle" width="100%">
                <mx:Image source="{logo}" click="toVendorPage()"/>
                <mx:Spacer width="100%"/>
                <mx:TextArea backgroundAlpha="0" editable="false" selectable="false" borderStyle="none" width="620"
                             height="60"
                             text="Have a Google spreadsheet you want to slice and dice?"
                             fontSize="14"/>
                <mx:Spacer width="100%"/>
            </mx:HBox>
            <mx:HRule width="100%" strokeColor="#333333"/>
            <mx:Box id="controlsBox" width="100%" horizontalAlign="center">
                <mx:Button label="Connect to Google Spreadsheets" fontSize="20" click="initialSetup()" styleName="grayButton"
                           id="installButton"/>
            </mx:Box>
            <mx:HRule width="100%" strokeColor="#333333"/>
            <mx:TextArea
                    text="You can connect Easy Insight to Google Spreadsheets. The file should have a header row, with data in the subsequent cells, as shown below:"
                    borderThickness="0"
                    width="480" height="65" backgroundAlpha="0" editable="false" fontSize="14"/>
            <mx:Image source="../assets/excelexample.png"/>
            <mx:TextArea width="480" height="50"
                         text="You may experience unexpected results if the data does not match that pattern."
                         borderThickness="0" backgroundAlpha="0" editable="false"
                         fontSize="14"/>
        </mx:VBox>
        <solutions:HeaderShadeArea width="50" height="100%" leftColor="#FFFFFF" rightColor="#000000"/>
    </mx:HBox>
</solutions:SolutionDetailRenderer>