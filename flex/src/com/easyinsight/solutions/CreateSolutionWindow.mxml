<?xml version="1.0" encoding="utf-8"?>
<util:EITitleWindow xmlns:util="com.easyinsight.util.*" xmlns:mx="http://www.adobe.com/2006/mxml">
	<mx:Script>
		<![CDATA[


        import com.easyinsight.util.PopUpUtil;

        import mx.controls.Alert;
        import mx.managers.PopUpManager;



        private function updateImage():void {
            if (_solution == null) {
                Alert.show("Save the solution before adding an image.");
            } else {
                var window:UpdateSolutionImageWindow = new UpdateSolutionImageWindow();
                window.sourceID = _solution.solutionID;
                PopUpManager.addPopUp(window, this, true);
                PopUpUtil.centerPopUp(window);
            }
        }

        private function updateArchive():void {
            if (_solution == null) {
                Alert.show("Save the solution before adding an archive.");
            } else {
                var window:UpdateSolutionArchiveWindow = new UpdateSolutionArchiveWindow();
                window.sourceID = _solution.solutionID;
                PopUpManager.addPopUp(window, this, true);
                PopUpUtil.centerPopUp(window);
            }
        }

        private var _solution:Solution;

        [Bindable]
        private var solutionCategory:int;

        [Bindable]
        private var nameText:String;
        [Bindable]
        private var logoLink:String;
        [Bindable]
        private var includeData:Boolean;
        [Bindable]
        private var industry:String;
        [Bindable]
        private var tags:String;
        [Bindable]
        private var solutionTier:int;
        [Bindable]
        private var archiveName:String;
        [Bindable]
        private var solutionImage:Bitmap;

        private function onComplete(event:Event):void {
            var loaderContent:LoaderInfo = event.currentTarget as LoaderInfo;
            solutionImage = Bitmap(loaderContent.loader.content);
            loaderContent.loader.removeEventListener(Event.COMPLETE, onComplete);
        }

        public function set solution(solution:Solution):void {
            this._solution = solution;
            nameText = this._solution.name;
            industry = this._solution.industry;
            includeData = this._solution.copyData;
            solutionTier = this._solution.solutionTier - 1;
            logoLink = this._solution.logoLink;
            solutionCategory = this._solution.category - 1;
            archiveName = _solution.solutionArchiveName;
            dataSourceType = String(_solution.dataSourceType);
            if (solution.image != null) {
                var loader:Loader = new Loader();
                loader.contentLoaderInfo.addEventListener(Event.COMPLETE, onComplete);
                loader.loadBytes(solution.image);
            }
        }

        [Bindable]
        private var dataSourceType:String;

        private function save():void {
            if (_solution == null) {
                _solution = new Solution();
            }
            _solution.name = nameInput.text;
            _solution.solutionTier = accountTierBox.selectedIndex + 1;
            _solution.category = solutionCategoryBox.selectedIndex + 1;
            _solution.dataSourceType = int(typeInput.text);

            if (_solution.solutionID == 0) {
                solutionService.addSolution.send(_solution);
            } else {
                solutionService.updateSolution.send(_solution);
            }
        }

        private function cancel():void {
            PopUpManager.removePopUp(this);
        }

        private function saveCompleted():void {
            dispatchEvent(new SolutionAdminEvent());
            PopUpManager.removePopUp(this);
        }
		]]>
	</mx:Script>
	<mx:RemoteObject destination="solutionService" id="solutionService">
		<mx:method name="addSolution" result="saveCompleted()"/>
		<mx:method name="updateSolution" result="saveCompleted()"/>
	</mx:RemoteObject>

        <mx:Form>
            <mx:FormItem label="Name: ">
                <mx:TextInput id="nameInput" text="{nameText}"/>
            </mx:FormItem>
            <mx:FormItem label="Archive Name: " direction="horizontal">
                <mx:Label text="{archiveName}"/>
                <mx:Button label="Update Archive" click="updateArchive()"/>
            </mx:FormItem>
            <mx:FormItem label="Required Account Tier: ">
                <mx:ComboBox id="accountTierBox" selectedIndex="{solutionTier}">
                    <mx:dataProvider>
                        <mx:ArrayCollection>
                            <mx:Array>
                                <mx:String>Free</mx:String>
                                <mx:String>Individual</mx:String>
                                <mx:String>Group</mx:String>
                                <mx:String>Professional</mx:String>
                                <mx:String>Enterprise</mx:String>
                                <mx:String>Admin (Hidden)</mx:String>
                            </mx:Array>
                        </mx:ArrayCollection>
                    </mx:dataProvider>
                </mx:ComboBox>
            </mx:FormItem>
            <mx:FormItem label="Solution Category: ">
                <mx:ComboBox id="solutionCategoryBox" selectedIndex="{solutionCategory}">
                    <mx:dataProvider>
                        <mx:ArrayCollection>
                            <mx:Array>
                                <mx:String>SaaS</mx:String>
                                <mx:String>Client</mx:String>
                                <mx:String>Learning</mx:String>
                                <mx:String>Business</mx:String>
                                <mx:String>Hidden</mx:String>
                            </mx:Array>
                        </mx:ArrayCollection>
                    </mx:dataProvider>
                </mx:ComboBox>
            </mx:FormItem>
            <mx:FormItem label="Image: " direction="vertical">
                <mx:Button label="Update Image" click="updateImage()"/>
                <mx:Image source="{solutionImage}"/>
            </mx:FormItem>
            <mx:FormItem label="Data Source Type:">
                <mx:TextInput id="typeInput" text="{dataSourceType}"/>
            </mx:FormItem>
        </mx:Form>
    <mx:HBox width="100%" horizontalAlign="center">
        <util:SaveButton label="Save" click="save()"/>
        <util:CancelButton label="Cancel" click="cancel()"/>
    </mx:HBox>
</util:EITitleWindow>
