<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%">
	<mx:Script>
		<![CDATA[
			import mx.controls.Alert;
			import com.easyinsight.framework.User;
			import mx.collections.ArrayCollection;
			
			[Bindable]
			private var description:String;
			
			private var _solution:Solution;
			
			[Bindable]
			private var solutionFileName:String;
			
			[Bindable]
			private var displayTreeData:ArrayCollection;
			
			private var fileRef:FileReference;
			
			[Bindable]
			private var downloadAvailable:Boolean = true;
						
			[Bindable]
			[Embed(source="../../../../assets/data_blue_x16.png")]
        	public var listIcon:Class;
        	
        	[Bindable]
        	[Embed(source="../../../../assets/gear.png")]
        	public var archiveIcon:Class;
                
            [Bindable]
	        [Embed(source="../../../../assets/chart_column.png")]
	        public var crosstabIcon:Class;
	        
	        public function set treeData(data:ArrayCollection):void {
	        	this.displayTreeData = data;
	        }
	        
	        public function set solution(solution:Solution):void {
	        	this._solution = solution;
	        	description = solution.description;
	        	solutionFileName = solution.solutionArchiveName;
	        	if (solution.solutionArchiveName == null || solution.solutionArchiveName == "") {
	        		downloadAvailable = false;
	        	}
	        }
	        
	        private function iconFunction(item:Object, depth:int):Class {            	
            	return listIcon;
            }
            
            private function download():void {
				//fileReference = new FileReference();
				var request:URLRequest = new URLRequest("/DMS/DownloadServlet");
				request.method = URLRequestMethod.GET;
				var vars:URLVariables = new URLVariables();
	
	            vars.userName = new String(User.getInstance().userName);
	            vars.password = new String(User.getInstance().password);
	            vars.operation = new String(2);
	            vars.fileID = new String(_solution.solutionID);           
	            request.data = vars;            
	
	            fileRef = new FileReference();
	            fileRef.addEventListener(Event.CANCEL, doEvent);
	            fileRef.addEventListener(Event.COMPLETE, complete);
	            fileRef.addEventListener(Event.OPEN, doEvent);
	            fileRef.addEventListener(Event.SELECT, doEvent);
	            fileRef.addEventListener(HTTPStatusEvent.HTTP_STATUS, doEvent);
	            fileRef.addEventListener(IOErrorEvent.IO_ERROR, doEvent);
	            fileRef.addEventListener(ProgressEvent.PROGRESS, doEvent);
	            fileRef.addEventListener(SecurityErrorEvent.SECURITY_ERROR, doEvent);
	
	            fileRef.download(request, _solution.solutionArchiveName); 
			}
			
			private function doEvent(event:Event):void {
				trace(event);
			}
			
			private function complete(event:Event):void {
				Alert.show("Solution files copied!");
			}
		]]>
	</mx:Script>
	<mx:VBox width="100%" height="100%">
		<mx:ApplicationControlBar visible="{downloadAvailable}">
			<mx:Label text="Files Downloadable for this Solution"/>
		</mx:ApplicationControlBar>
		<mx:HBox visible="{downloadAvailable}">
			<mx:Label text="File: "/>
			<mx:Label text="{solutionFileName}"/>
			<mx:Button icon="{archiveIcon}" click="download()" toolTip="Download File"/>
		</mx:HBox>
		<mx:ApplicationControlBar>
			<mx:Label text="Data Sources and Insights Installed with this Solution"/>
		</mx:ApplicationControlBar>
		<mx:AdvancedDataGrid width="100%" height="100%" id="uploadGrid" selectable="false" fontSize="12"
			groupIconFunction="iconFunction" defaultLeafIcon="{crosstabIcon}">
			<mx:dataProvider>
	            <mx:HierarchicalData source="{displayTreeData}"/>
	        </mx:dataProvider>
			<mx:columns>				
				<mx:AdvancedDataGridColumn headerText="Name" dataField="name"/>										
			</mx:columns>
		</mx:AdvancedDataGrid>
	</mx:VBox>
</mx:Canvas>
