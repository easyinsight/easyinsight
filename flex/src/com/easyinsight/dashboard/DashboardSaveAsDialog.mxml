<?xml version="1.0" encoding="utf-8"?>
<util:EISlimWindow xmlns:util="com.easyinsight.util.*" xmlns:mx="http://www.adobe.com/2006/mxml"
                    creationComplete="addEventListener(KeyboardEvent.KEY_UP, keyHit); focusManager.setFocus(dashboardName);
	validators = [nameValidator]">
    <mx:Script>
		<![CDATA[
        import com.easyinsight.analysis.SavedAnalysisEvent;
        import com.easyinsight.util.ProgressAlert;

        import mx.managers.PopUpManager;
        import mx.validators.Validator;

        [Bindable]
        public var dashboard:Dashboard;

        private var validators:Array;

        private function save():void {
            var results:Array = Validator.validateAll(validators);
            if (results.length == 0) {
                ProgressAlert.alert(this, "Saving dashboard...", null, dashboardService.saveAs);
                dashboardService.saveAs(dashboard, dashboardName.text);
                PopUpManager.removePopUp(this);
            } else {
                dashboardName.setFocus();
                dashboardName.dispatchEvent(new MouseEvent(MouseEvent.MOUSE_OVER));
            }
        }

        private function keyHit(event:KeyboardEvent):void {
            if (event.keyCode == Keyboard.ENTER) {
                save();
            }
        }

        private function cancel():void {
            PopUpManager.removePopUp(this);
        }

        private function saved():void {
            var savedDef:Dashboard = dashboardService.saveAs.lastResult as Dashboard;
            //AnalysisUtil.updateReport(analysisDefinition, savedDef);
            dispatchEvent(new SavedDashboardEvent(savedDef));
            PopUpManager.removePopUp(this);
        }

        private function passThrough(event:SavedAnalysisEvent):void {
            dispatchEvent(event);
        }
        ]]>
    </mx:Script>
    <mx:VBox width="100%" height="100%">
        <mx:Form>
            <mx:FormItem label="Dashboard Name:" direction="horizontal">
                <mx:TextInput id="dashboardName" width="300"/>
            </mx:FormItem>
            <mx:FormItem label="" direction="horizontal">
                <util:SaveButton label="Save" click="save()"/>
                <util:CancelButton label="Cancel" click="cancel()"/>
            </mx:FormItem>
        </mx:Form>
    </mx:VBox>
    <mx:StringValidator source="{dashboardName}" property="text" minLength="2" id="nameValidator"/>
    <mx:RemoteObject id="dashboardService" destination="dashboardService">
        <mx:method name="saveAs" result="saved()"/>
    </mx:RemoteObject>
</util:EISlimWindow>