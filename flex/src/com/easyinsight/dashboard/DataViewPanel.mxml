<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" alpha="1" backgroundAlpha=".1"
	width="100%" height="100%" backgroundColor="#FFFFFF" implements="com.easyinsight.dashboard.IView">
	<mx:Metadata>
		[Event(name="analyze", type="com.easyinsight.genredata.AnalyzeEvent")]
		[Event(name="returnToList", type="com.easyinsight.dashboard.ReturnToListEvent")]
	</mx:Metadata> 
	<mx:Script>
		<![CDATA[
        import com.easyinsight.analysis.EmbeddedControllerLookup;
        import com.easyinsight.analysis.EmbeddedViewFactory;
        import com.easyinsight.analysis.IEmbeddedReportController;

        import mx.controls.Alert;
        import mx.controls.Label;
        import mx.rpc.events.FaultEvent;


        [Bindable]
        private var title:String;
        private var _analysisID:int;
        private var _reportType:int;
        [Bindable]
        private var _dataSourceID:int;
        [Bindable]
        private var _reportName:String;

        private var _prefix:String = "";

        private var _titleFunction:Function;
        private var _titleFunctionCaller:Object;

        private var dataViewFactory:EmbeddedViewFactory;

        public function set dataSourceID(val:int):void {
            _dataSourceID = val;
            invalidateProperties();
        }

        public function set prefix(val:String):void {
            _prefix = val;
            invalidateProperties();
        }

        public function set reportType(val:int):void {
            _reportType = val;
            invalidateProperties();
        }

        public function set reportName(val:String):void {
            _reportName = val;
            invalidateProperties();
        }

        public function set titleClickFunction(functionName:Function):void {
            _titleFunction = functionName;
            invalidateProperties();
        }

        public function set titleFunctionCaller(val:Object):void {
            _titleFunctionCaller = val;
            invalidateProperties();
        }

        public function set analysisID(analysisID:int):void {
            this._analysisID = analysisID;
            invalidateProperties();
        }

        override protected function commitProperties():void {
            super.commitProperties();
            if(_reportType != 0) {
                if(dataViewFactory != null)
                    coreVBox.removeChild(dataViewFactory);

                var controllerClass:Class = EmbeddedControllerLookup.controllerForType(_reportType);
                var controller:IEmbeddedReportController = new controllerClass();
                dataViewFactory = controller.createEmbeddedView();
                dataViewFactory.prefix = _prefix;
                dataViewFactory.reportID = _analysisID;
                dataViewFactory.dataSourceID = _dataSourceID;
                coreVBox.addChild(dataViewFactory);
                dataViewFactory.retrieveData(false);                
            }
        }

        private function titleClick():void {
            if (_titleFunction != null) {
                _titleFunction.call(_titleFunctionCaller, _analysisID, _reportName, _reportType, _dataSourceID);
            }
        }

        private function failure(event:FaultEvent):void {
            var failureLabel:String = event.message.toString();
            var label:Label = new Label();
            label.text = failureLabel;
            coreVBox.addChild(label);
        }

        private function returnToList():void {
            dispatchEvent(new ReturnToListEvent());
        }

        public function refreshData():void {
            dataViewFactory.retrieveData(false);
        }
                ]]>
	</mx:Script>
	<mx:ApplicationControlBar width="100%" horizontalAlign="center">
		<mx:LinkButton label="{_reportName}" click="titleClick()" textDecoration="underline"/>		
	</mx:ApplicationControlBar>	
	<mx:VBox id="coreVBox" height="100%" width="100%">
	</mx:VBox>
</mx:VBox>
