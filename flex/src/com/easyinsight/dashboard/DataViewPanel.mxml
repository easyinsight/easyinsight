<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:analysis="analysis.*" alpha="1" backgroundAlpha=".1" 
	width="100%" height="100%" backgroundColor="#FFFFFF">
	<mx:Metadata>
		[Event(name="analyze", type="com.easyinsight.genredata.AnalyzeEvent")]
		[Event(name="returnToList", type="com.easyinsight.dashboard.ReturnToListEvent")]
	</mx:Metadata> 
	<mx:Script>
		<![CDATA[
        import com.easyinsight.analysis.EmbeddedViewFactory;
        import com.easyinsight.analysis.IReportController;

        import mx.controls.Alert;
import mx.controls.Label;
        import mx.rpc.events.FaultEvent;

        import mx.managers.PopUpManager;

        import com.easyinsight.analysis.AnalysisDefinition;

        private var definition:AnalysisDefinition;
        [Bindable]
        private var showReturnToList:Boolean;
        [Bindable]
        private var title:String;
        private var _analysisID:int;

        private var titleFunction:Function;

        public function set titleClickFunction(functionName:Function):void {
            this.titleFunction = functionName;
        }

        public function set analysisID(analysisID:int):void {
            this._analysisID = analysisID;
        }

        private function gotAnalysisDefinition():void {
            this.definition = analysisService.openAnalysisDefinition.lastResult as AnalysisDefinition;
            var controllerClass:Class = Class(getDefinitionByName(this.definition.controller));
            var controller:IReportController = new controllerClass();
            var dataViewFactory:EmbeddedViewFactory = controller.createEmbeddedView();
            dataViewFactory.analysisDefinition = definition;
            coreVBox.addChild(dataViewFactory);
            dataViewFactory.retrieveData();
        }

        public function set analysisDefinition(definition:AnalysisDefinition):void {
            this.definition = definition;
        }


        override protected function createChildren():void {
            super.createChildren();
            analysisService.openAnalysisDefinition.send(_analysisID);
        }

        private function closeThis():void {
            PopUpManager.removePopUp(this);
        }

        private function titleClick():void {
        }

        private function failure(event:FaultEvent):void {
            var failureLabel:String = event.message.toString();
            var label:Label = new Label();
            label.text = failureLabel;
            coreVBox.addChild(label);
        }

        private function returnToList():void {
            dispatchEvent(new ReturnToListEvent());
        }
                ]]>
	</mx:Script>
	<mx:RemoteObject id="analysisService" destination="analysisDefinition">
		<mx:method name="openAnalysisDefinition" result="gotAnalysisDefinition()" fault="failure(event)"/>
	</mx:RemoteObject>
	<mx:ApplicationControlBar width="100%" horizontalAlign="center">
		<mx:LinkButton label="{title}" click="titleClick()" textDecoration="underline"/>
		<mx:Button label="Return" click="returnToList()" visible="{showReturnToList}"/>
	</mx:ApplicationControlBar>	
	<mx:VBox id="coreVBox" height="100%" width="100%">
		<!-- <mx:HBox width="100%">
			<mx:Label text="Search:"/>
			<mx:TextInput change="search()" id="searchInput"/>
			<mx:Button label="Analyze" click="analyze()"/>	
		</mx:HBox> -->
	</mx:VBox>
</mx:VBox>
