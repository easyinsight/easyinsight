<?xml version="1.0" encoding="utf-8"?>
<mx:Module xmlns:mx="http://www.adobe.com/2006/mxml" implements="com.easyinsight.dashboard.IViewFactory">
	<mx:Script>
		<![CDATA[
			import com.easyinsight.map.ILogMapView;
			import com.easyinsight.analysis.AnalysisItem;
			import com.easyinsight.analysis.AnalysisCalculation;
			import com.easyinsight.analysis.AnalysisList;
			import com.easyinsight.analysis.AnalysisRangeDimension;
			import com.easyinsight.analysis.AnalysisDateDimension;
			import com.easyinsight.analysis.AnalysisDimension;
			import com.easyinsight.analysis.AnalysisMeasure;
			import mx.collections.ArrayCollection;
			import com.easyinsight.framework.DataService;
			import com.easyinsight.analysis.FeedMetadata;
			import com.easyinsight.analysis.AnalysisDefinition;
			
			private var mapView:ILogMapView;
			
			public function createDisplay(definition:AnalysisDefinition):DisplayObject {
				mapView = new ILogMapView();
				var dataService:DataService = new DataService();
                dataService.dataFeedID = definition.dataFeedID;                
                mapView.showDropAreas = false;
                mapView.dataService = dataService;
                mapView.analysisDefinition = definition;                                       
                dataService.reloadInitialContent(this, handleFeedMetadata);
                mapView.visible = false;                
                return mapView;
			}
			
			private function handleFeedMetadata(feedMetadata:FeedMetadata):void {				
                mapView.availableFields = new ArrayCollection(feedMetadata.fields);
                mapView.initializeToDefinition();
                mapView.visible = true;
            }
            
            private function annoyingDependencies():void {
            	var analysisMeasure:AnalysisMeasure;
            	var analysisDimension:AnalysisDimension;
            	var analysisDateDimension:AnalysisDateDimension;
            	var analysisRangeDimension:AnalysisRangeDimension;
            	var analysisList:AnalysisList;
            	var analysisCalc:AnalysisCalculation;
            	var analysisItem:AnalysisItem;
            }
		]]>
	</mx:Script>
	<mx:Style source="com/easyinsight/skin/osx/OSX.css"/>
</mx:Module>
