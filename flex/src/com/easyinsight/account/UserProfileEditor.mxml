<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%"
	initialize="initHandlers()" backgroundAlpha=".95" backgroundColor="#FFFFFF">
	<mx:states>
		<mx:State name="security">
			
		</mx:State>
	</mx:states>
	<mx:Script>
		<![CDATA[
        import com.easyinsight.framework.User;
import mx.events.ItemClickEvent;

        import com.easyinsight.framework.UserTransferObject;

        import mx.managers.PopUpManager;
        import mx.validators.Validator;

        [Bindable]
        private var _userNameText:String;

        [Bindable]
        private var _fullNameText:String;

        [Bindable]
        private var _emailText:String;

        [Bindable]
        private var _securityConfigurable:Boolean = false;

        private var validators:Array;


        public function set userNameText(val:String):void {
            _userNameText = val;
        }

        public function set fullNameText(val:String):void {
            _fullNameText = val;
        }

        public function set emailText(val:String):void {
            _emailText = val;
        }

        private function initHandlers():void {
            validators = [ emailValidator, userNameValidator, fullNameValidator ];
        }

        private function save():void {
            var results:Array = Validator.validateAll(validators);
            if (results.length > 0) {
                var failureMessage:String = "There are one or more problems with the fields above.";
                failureMessageLabel.text = failureMessage;
            } else {
                failureMessageLabel.text = "";
                creationService.updateUserLabels.send(userName.text, fullName.text, email.text);
            }
        }

        private function onItemClick(event:ItemClickEvent):void {
            if (event.label == "Profile") {
                currentState = "";
            } else if (event.label == "Security") {
                currentState = "security";
            }
        }

        private function savedUser():void {
            User.getInstance().updateLabels(userName.text, fullName.text, email.text);
            dispatchEvent(new RefreshAccountEvent());
            PopUpManager.removePopUp(this);
        }
                ]]>
	</mx:Script>
	
	<mx:VBox width="100%" height="100%" styleName="TitleWindowContents">
        <!--
		<mx:HBox width="100%">
            <mx:ToggleButtonBar itemClick="onItemClick(event)" visible="{_securityConfigurable}">
                <mx:dataProvider>
                    <mx:Array>
                        <mx:String>Profile</mx:String>
                        <mx:String>Security</mx:String>
                    </mx:Array>
                </mx:dataProvider>
            </mx:ToggleButtonBar>
			<mx:Button label="Profile" id="profileButton" click="currentState=''" styleName="blueButton"/>
			<mx:Button label="Security" id="securityButton" click="currentState='security'"/>
		</mx:HBox>
				-->
		<mx:Form>
			<mx:FormItem label="User ID:" direction="horizontal" fontFamily="Tahoma" fontWeight="bold">
				<mx:TextInput id="userName" text="{_userNameText}" fontFamily="Lucida Grande" fontWeight="normal"/>
			</mx:FormItem>
			<mx:FormItem label="Name:" direction="horizontal" fontFamily="Tahoma" fontWeight="bold">
				<mx:TextInput id="fullName" text="{_fullNameText}" fontFamily="Lucida Grande" fontWeight="normal"/>
			</mx:FormItem>
			<mx:FormItem label="Email Address:" direction="horizontal" fontFamily="Tahoma" fontWeight="bold">
				<mx:TextInput id="email" text="{_emailText}" fontFamily="Lucida Grande" fontWeight="normal"/>
			</mx:FormItem>
			<mx:FormItem label="">
				<mx:Text text="" id="failureMessageLabel"/>
			</mx:FormItem>
		</mx:Form>
        <mx:HBox width="100%">
            <mx:Button label="Save" click="save()"/>
            <mx:Button label="Cancel" click="PopUpManager.removePopUp(this)"/>
        </mx:HBox>
	</mx:VBox>
	<mx:StringValidator source="{userName}" property="text" id="userNameValidator" minLength="3" maxLength="20"/>	
	<mx:StringValidator source="{fullName}" property="text" id="fullNameValidator" minLength="3" maxLength="40"/>
	<mx:EmailValidator source="{email}" property="text" id="emailValidator"/>
	<mx:RemoteObject id="creationService" destination="login">
		<mx:method name="updateUserLabels" result="savedUser()"/>
	</mx:RemoteObject>
</mx:TitleWindow>
