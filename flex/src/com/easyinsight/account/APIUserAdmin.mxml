<?xml version="1.0" ?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" creationComplete="retrieveData()" width="100%" height="100%">
    <mx:Script><![CDATA[
        import com.easyinsight.customupload.api.APIUpdateEvent;
        import com.easyinsight.framework.User;

        import com.easyinsight.util.ProgressAlert;

        import mx.managers.PopUpManager;

        private function onEnable(event:Event):void {
            apiEnabled = apiEnabledAccount.selected;
        }

        [Bindable]
        private var apiEnabled:Boolean;

        [Bindable]
        private var accountAPIKey:String;

        [Bindable]
        private var accountAPISecretKey:String;

        [Bindable]
        private var userAPIKey:String;

        [Bindable]
        private var userAPISecretKey:String;

        [Bindable]
        private var showingSecretAccountKey:Boolean;
        [Bindable]
        private var showingSecretUserKey:Boolean;

        private var accountAPISettings:AccountAPISettings;

        [Bindable]
        private var secretKeyButton:String = "Show Secret Key";
        [Bindable]
        private var secretAccountButton:String = "Show Secret Key";

        [Bindable]
        private var accountAdmin:Boolean;

        private function showSecretAccountKey():void {
            if (showingSecretAccountKey) {
                showingSecretAccountKey = false;
                secretAccountButton = "Show Secret Key";
            } else {
                showingSecretAccountKey = true;
                secretAccountButton = "Hide Secret Key";
            }
        }

        private function showSecretUserKey():void {
            if (showingSecretUserKey) {
                showingSecretUserKey = false;
                secretKeyButton = "Show Secret Key";
            } else {
                showingSecretUserKey = true;
                secretKeyButton = "Hide Secret Key";
            }
        }

        private function retrieveData():void {
            accountAdmin = User.getInstance().accountAdmin;
            adminService.getAccountAPISettings.send();
        }

        private function regenerated():void {
            adminService.getAccountAPISettings.send();
        }

        private function gotSettings():void {
            accountAPISettings = adminService.getAccountAPISettings.lastResult as AccountAPISettings;
            apiEnabled = accountAPISettings.apiEnabled;            
            accountAPIKey = accountAPISettings.accountKey;
            accountAPISecretKey = accountAPISettings.accountSecretKey;
        }

        private function copyKeyToClipboard():void {
            System.setClipboard(accountAPIKey);
        }

        private function copySecretKeyToClipboard():void {
            System.setClipboard(accountAPISecretKey);
        }

        private function save():void {
            var accountSettings:AccountSettings = new AccountSettings();
            accountSettings.apiEnabled = apiEnabledAccount.selected;
            ProgressAlert.alert(this, "Saving API settings...", null, adminService.saveAccountSettings);
            adminService.saveAccountSettings.send(accountSettings);
        }

        private function savedSettings():void {
            dispatchEvent(new APIUpdateEvent());
            PopUpManager.removePopUp(this);
        }
        ]]></mx:Script>
    <mx:RemoteObject destination="accountAdmin" id="adminService">
        <mx:method name="saveAccountSettings" result="savedSettings()"/>
        <mx:method name="getAccountAPISettings" result="gotSettings()"/>
        <mx:method name="regenerateUserSecretKey" result="regenerated()"/>
        <mx:method name="regenerateAccountSecretKey" result="regenerated()"/>
    </mx:RemoteObject>
    <mx:VBox width="100%" height="100%" horizontalAlign="center" paddingTop="10" paddingBottom="10" paddingLeft="10" paddingRight="10">
        <mx:VBox id="accountSettingsBox" paddingLeft="20" paddingRight="20" paddingTop="20" paddingBottom="20">            
            <mx:Form paddingBottom="0" paddingLeft="0" paddingRight="0" paddingTop="0">
                <mx:FormItem label="API Enabled for the Account: ">
                    <mx:CheckBox id="apiEnabledAccount" selected="{apiEnabled}" enabled="{accountAdmin}" change="onEnable(event)"/>
                </mx:FormItem>
            </mx:Form>
            <mx:HRule width="100%"/>
            <mx:Label text="The keys below are your personal credentials for publishing data into Easy Insight through the API."/>
            <mx:Form paddingBottom="0" paddingLeft="0" paddingRight="0" paddingTop="0">                
                <mx:FormItem label="API Key: " direction="horizontal" enabled="{apiEnabled}">
                    <mx:Text text="{accountAPIKey}"/>
                    <mx:Button label="Copy to Clipboard" click="copyKeyToClipboard()"/>
                </mx:FormItem>
                <mx:FormItem label="API Secret Key: " direction="horizontal" enabled="{apiEnabled}">
                    <mx:Button label="Regenerate Secret Key" click="adminService.regenerateUserSecretKey.send()"/>
                    <mx:Button label="{secretKeyButton}" click="showSecretUserKey()"/>
                    <mx:Text text="{accountAPISecretKey}" visible="{showingSecretUserKey}"/>
                    <mx:Button label="Copy to Clipboard" click="copySecretKeyToClipboard()" visible="{showingSecretUserKey}"/>
                </mx:FormItem>
            </mx:Form>
            <mx:HRule width="100%"/>
            <mx:Label text="The keys below are account-wide credentials for publishing data into Easy Insight through the API."/>
            <mx:Form paddingBottom="0" paddingLeft="0" paddingRight="0" paddingTop="0">
                <mx:FormItem label="API Key: " direction="horizontal" enabled="{apiEnabled}">
                    <mx:Text text="{accountAPIKey}"/>
                    <mx:Button label="Copy to Clipboard" click="copyKeyToClipboard()"/>
                </mx:FormItem>
                <mx:FormItem label="API Secret Key: " direction="horizontal" enabled="{apiEnabled}">
                    <mx:Button label="Regenerate Secret Key" click="adminService.regenerateAccountSecretKey.send()" enabled="{accountAdmin}"/>
                    <mx:Button label="{secretKeyButton}" click="showSecretAccountKey()()"/>
                    <mx:Text text="{accountAPISecretKey}" visible="{showingSecretAccountKey}"/>
                    <mx:Button label="Copy to Clipboard" click="copySecretKeyToClipboard()" visible="{showingSecretAccountKey}"/>
                </mx:FormItem>
            </mx:Form>
        </mx:VBox>
        <mx:HRule width="100%"/>
        <mx:HBox width="100%" horizontalAlign="center">
            <mx:Button label="Save" click="save()"/>
            <mx:Button label="Cancel" click="PopUpManager.removePopUp(this)"/>
        </mx:HBox>
    </mx:VBox>
</mx:TitleWindow>