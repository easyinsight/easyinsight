<?xml version="1.0" ?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" creationComplete="initProperties()"
         width="100%" height="100%" styleName="basePageVBox" implements="com.easyinsight.listing.IPerspective">
    <mx:Script><![CDATA[
        import com.easyinsight.util.PopUpUtil;

        import mx.managers.PopUpManager;

        import com.easyinsight.framework.User;

        [Bindable]
        private var userName:String;
        [Bindable]
        private var fullName:String;
        [Bindable]
        private var email:String;
        [Bindable]
        private var firstName:String;
        [Bindable]
        private var lastName:String;
        [Bindable]
        private var apiKey:String;
        [Bindable]
        private var apiSecretKey:String;
        [Bindable]
        private var newsletterOptIn:Boolean;

        private function initProperties():void {
            this.userName = User.getInstance().userName;
            this.fullName = User.getInstance().firstName + " " + User.getInstance().getName();
            this.firstName = User.getInstance().firstName;
            this.lastName = User.getInstance().getName();
            this.email = User.getInstance().getEmail();
            this.apiKey = User.getInstance().apiKey;
            this.apiSecretKey = User.getInstance().apiSecretKey;
            this.newsletterOptIn = User.getInstance().newsletterEnabled;
        }

        private function editProfile():void {
            var editor:UserProfileEditor = new UserProfileEditor();
            editor.userNameText = userName;
            editor.fullNameText = lastName;
            editor.firstNameText = firstName;
            editor.emailText = email;
            editor.newsletterOptIn = newsletterOptIn;
            editor.addEventListener(RefreshAccountEvent.REFRESH_ACCOUNT, onProfileEdit, false, 0, true);
            PopUpManager.addPopUp(editor, this, true);
            PopUpUtil.centerPopUp(editor);
        }

        private function onProfileEdit(event:RefreshAccountEvent):void {
            event.currentTarget.removeEventListener(RefreshAccountEvent.REFRESH_ACCOUNT, onProfileEdit);
            initProperties();
        }

        private function editPassword():void {
            var window:ChangePasswordWindow = new ChangePasswordWindow();
            PopUpManager.addPopUp(window, this, true);
            PopUpUtil.centerPopUp(window);
        }

        public function gotFocus():void {
        }

        public function cleanup():void {
        }
        ]]></mx:Script>
    <mx:VBox id="userProfileBox" horizontalAlign="center" paddingTop="20">
        <mx:HBox>
            <mx:Button label="Edit Profile..." click="editProfile()" styleName="grayButton"/>
            <mx:Button label="Change Password..." click="editPassword()" styleName="grayButton"/>
        </mx:HBox>
        <mx:Form width="100%" paddingBottom="0" paddingLeft="0" paddingRight="0" paddingTop="0">
            <mx:FormItem label="User Name:">
                <mx:TextInput text="{userName}" editable="false" width="400"/>
            </mx:FormItem>
            <mx:FormItem label="Full Name:" fontFamily="Tahoma" fontWeight="bold" direction="horizontal">
                <mx:TextInput text="{fullName}" editable="false" width="400"/>
            </mx:FormItem>
            <mx:FormItem label="Email Address:">
                <mx:TextInput text="{email}" editable="false" width="400"/>
            </mx:FormItem>
            <mx:FormItem label="API Key:">
                <mx:TextInput text="{apiKey}" editable="false" width="400"/>
            </mx:FormItem>
            <mx:FormItem label="API Secret Key:">
                <mx:TextInput text="{apiSecretKey}" editable="false" width="400"/>
            </mx:FormItem>
            <mx:FormItem label="Send Newsletter:">
                <mx:CheckBox selected="{newsletterOptIn}" enabled="false" width="400"/>
            </mx:FormItem>
        </mx:Form>
    </mx:VBox>
</mx:VBox>