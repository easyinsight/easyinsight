<?xml version="1.0" ?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"
                        xmlns:kpi="com.easyinsight.kpi.*"
                        xmlns:viewStackEffects="org.efflex.mx.viewStackEffects.*" xmlns:account="com.easyinsight.account.*"
                        width="100%" height="100%" implements="com.easyinsight.listing.IPerspective"
        creationComplete="setup()">
    <mx:Script><![CDATA[
        import com.easyinsight.analysis.AnalysisCloseEvent;
        import com.easyinsight.framework.User;
        import com.easyinsight.kpi.KPITutorialEvent;
        import com.easyinsight.preferences.Persona;

        [Bindable]
        private var panelIndex:int;

        [Bindable]
        private var setupData:AccountSetupData = new AccountSetupData();

        private function setup():void {

        }

        private function next(event:KPITutorialEvent):void {
            panelIndex++;
        }

        private function back(event:KPITutorialEvent):void {
            panelIndex--;
        }

        private function onCancel(event:KPITutorialEvent):void {

        }

        private function onFinish(event:KPITutorialEvent):void {
            userService.applySetupData.send(setupData);
        }

        private function applied():void {
            User.getInstance().changeSettings(Persona(setupData.personas.getItemAt(setupData.myPersona)).uiSettings);
            dispatchEvent(new AnalysisCloseEvent());
        }

        public function gotFocus():void {
        }

        public function cleanup():void {
        }
        ]]></mx:Script>
    <mx:RemoteObject destination="login" id="userService">
        <mx:method name="applySetupData" result="applied()"/>
    </mx:RemoteObject>
    <viewStackEffects:CoverFlowPapervision3D id="leftEffect" direction="horizontal"/>
    <mx:VBox width="100%" height="100%" verticalGap="0">
        <mx:Box height="50%" width="100%" backgroundColor="0x000000"/>
        <mx:Box height="50%" width="100%" backgroundColor="0xAAAAAA"/>
    </mx:VBox>
    <mx:Box width="100%" height="100%" horizontalAlign="center" verticalAlign="middle">
        <mx:ViewStack selectedIndex="{panelIndex}"
                      id="viewStack" resizeToContent="true" width="800" height="550" creationPolicy="all"
                      backgroundColor="0xFFFFFF">
            <kpi:TutorialPanel width="100%" height="100%" hideEffect="leftEffect" showEffect="leftEffect">
                <account:DefaultPersonaPanel id="personaPanel" setupData="{setupData}"
                        kpiTutorialNext="panelIndex++"/>
                <kpi:TutorialButtons tutorialPanel="{personaPanel}" backEnabled="false"
                                     finishEnabled="false" backVisible="false" nextVisible="false"
                                     kpiTutorialCancel="onCancel(event)"/>
            </kpi:TutorialPanel>
            <kpi:TutorialPanel width="100%" height="100%" hideEffect="leftEffect" showEffect="leftEffect">
                <account:AddUsersPanel id="addUsersPanel" setupData="{setupData}"/>
                <kpi:TutorialButtons tutorialPanel="{addUsersPanel}" backEnabled="true" nextEnabled="true"
                                     finishEnabled="true"
                                     kpiTutorialNext="panelIndex++"
                                     kpiTutorialPrevious="panelIndex--"
                                     kpiTutorialFinish="onFinish(event)"
                                     kpiTutorialCancel="onCancel(event)"/>
            </kpi:TutorialPanel>
        </mx:ViewStack>
    </mx:Box>
</mx:Canvas>