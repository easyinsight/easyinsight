<?xml version="1.0" ?>
<util:EISlimWindow xmlns:util="com.easyinsight.util.*" xmlns:mx="http://www.adobe.com/2006/mxml" creationComplete="validators = [ passwordValidator ]">
    <mx:Script><![CDATA[

        import mx.controls.Alert;
import mx.validators.Validator;
import mx.managers.PopUpManager;

        private var validators:Array;

        private function save():void {
            var results:Array = Validator.validateAll(validators);
            if (results.length > 0) {
                newPasswordInput.setFocus();
                newPasswordInput.dispatchEvent(new MouseEvent(MouseEvent.MOUSE_OVER));
            } else {
                var a:Array = [/[0-9]/g, /[A-Z]/g, /[a-z]/g, /\W|_/g ];
                var count:int = 0;
                for(var o:Object in a) {
                    var r:RegExp = RegExp(o);
                    if(r.test(newPasswordInput.text)) {
                        count = count + 1

                    } else {
                        Alert.show(r.toString())
                        Alert.show(newPasswordInput.text);
                    }

                }
                if(count < 2) {
                    Alert.show("You must use at least two of the following types of characters - uppercase, lowercase, digits, and special characters in your password.");
                }
                else if (newPasswordInput.text != confirmNewPasswordInput.text) {
                    Alert.show("Your new password and confirmed new password do not match.");
                } else {
                    userService.updatePassword.send(currentPasswordInput.text, newPasswordInput.text);
                }
            }
        }

        private function updatedPassword():void {
            var encryptedPassword:String = userService.updatePassword.lastResult as String;
            if (encryptedPassword != null) {                
                PopUpManager.removePopUp(this);
            } else {
                Alert.show("Your current password was not correct.");
            }
        }

        private function cancel():void {
            PopUpManager.removePopUp(this);
        }
]]></mx:Script>
    <mx:RemoteObject destination="login" id="userService">
		<mx:method name="updatePassword" result="updatedPassword()"/>
	</mx:RemoteObject>
    <mx:Form>
		<mx:FormItem label="Current Password: " direction="horizontal">
			<mx:TextInput id="currentPasswordInput" displayAsPassword="true"/>
		</mx:FormItem>
        <mx:FormItem label="New Password: " direction="horizontal">
			<mx:TextInput id="newPasswordInput" displayAsPassword="true"/>
		</mx:FormItem>
        <mx:FormItem label="Confirm New Password: " direction="horizontal">
			<mx:TextInput id="confirmNewPasswordInput" displayAsPassword="true"/>
		</mx:FormItem>
        <mx:FormItem label="" direction="horizontal">
            <util:SaveButton label="Save" click="save()"/>
            <util:CancelButton label="Cancel" click="cancel()"/>
        </mx:FormItem>
    </mx:Form>
    <mx:StringValidator source="{newPasswordInput}" property="text" minLength="8" maxLength="20" id="passwordValidator"/>
</util:EISlimWindow>