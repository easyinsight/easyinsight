<?xml version="1.0" ?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%" implements="com.easyinsight.administration.feed.IFeedAdminDetail">
    <mx:Script><![CDATA[
        import com.easyinsight.administration.feed.FeedDefinitionData;
        import com.easyinsight.datasources.FreshbooksDataSource;
        import com.easyinsight.util.ProgressAlert;

        import mx.controls.Alert;

        [Bindable]
        private var url:String;
        [Bindable]
        private var liveDataSource:Boolean;

        private var feedDefinition:FeedDefinitionData;

        public function set dataSourceDefinition(feedDefinition:FeedDefinitionData):void {
            this.feedDefinition = feedDefinition;
        }

        public function updateDataSource(feedDefinition:FeedDefinitionData):void {
        }

        public function validate():Boolean {
            return true;
        }

        private function reauthorize():void {
            ProgressAlert.alert(this, "Authorizing...", null, tokenService.getOAuthURL);
            tokenService.getOAuthURL.send(feedDefinition.getFeedType(), true, null, feedDefinition, 2);
        }

        private function gotURL():void {
            var response:OAuthResponse = tokenService.getOAuthURL.lastResult as OAuthResponse;
            if (response.successful) {
                var requestToken:String = response.requestToken;
                navigateToURL(new URLRequest(requestToken), "_self");
            } else {
                Alert.show("We had a problem with authorization setup. Please contact support@easy-insight.com.");
            }
        }
        ]]></mx:Script>
    <mx:RemoteObject destination="tokenService" id="tokenService">
        <mx:method name="getOAuthURL" result="gotURL()"/>
    </mx:RemoteObject>
    <mx:Button label="Reauthorize Access" click="reauthorize()"/>
</mx:VBox>