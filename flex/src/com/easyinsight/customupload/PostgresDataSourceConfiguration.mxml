<?xml version="1.0" ?>
<feed:DataSourceWindow xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:util="com.easyinsight.util.*" width="100%"
                       height="100%" xmlns:feed="com.easyinsight.administration.feed.*"
        >
    <mx:Metadata>
		[Event(name="userConfigComplete", type="com.easyinsight.customupload.UploadConfigEvent")]
		[Event(name="userConfigCancel", type="com.easyinsight.customupload.UploadConfigEvent")]
	</mx:Metadata>
    <mx:Script><![CDATA[
        import com.easyinsight.datasources.PostgresDatabaseConnection;

        import mx.managers.PopUpManager;

        import mx.validators.Validator;

        [Bindable]
        private var host:String;
        [Bindable]
        private var port:String;
        [Bindable]
        private var databaseName:String;
        [Bindable]
        private var userName:String;
        [Bindable]
        private var query:String;

        private function save():void {
            if (validate()) {
                var obj:PostgresDatabaseConnection = dataSource as PostgresDatabaseConnection;
                obj.host = hostInput.text;
                obj.port = int(portInput.text);
                obj.databaseName = databaseNameInput.text;
                obj.dbUserName = databaseUserNameInput.text;
                obj.dbPassword = databasePasswordInput.text;
                obj.query = queryArea.text;
                obj.rebuildFields = true;
                saveSource();
            }
        }


        override protected function gotSource():void {
            var ds:PostgresDatabaseConnection = dataSource as PostgresDatabaseConnection;
            host = ds.host;
            port = String(ds.port);
            databaseName = ds.databaseName;
            userName = ds.dbUserName;
            query = ds.query;
        }

        public function validate():Boolean {
            return Validator.validateAll([hostValidator, portValidator, databaseNameValidator, queryValidator]).length == 0;
        }
        ]]></mx:Script>
    <mx:VBox horizontalAlign="center" paddingTop="5"><mx:Form>
            <mx:FormItem label="Database Host:" labelWidth="150">
                <mx:TextInput id="hostInput" fontWeight="normal" fontFamily="Lucida Grande" text="{host}" width="350"/>
            </mx:FormItem>
            <mx:FormItem label="Database Port:" labelWidth="150">
                <mx:TextInput id="portInput" fontWeight="normal" fontFamily="Lucida Grande" text="{port}" width="350"/>
            </mx:FormItem>
            <mx:FormItem label="Database Name:" labelWidth="150">
                <mx:TextInput id="databaseNameInput" fontWeight="normal" fontFamily="Lucida Grande" text="{databaseName}" width="350"/>
            </mx:FormItem>
            <mx:FormItem label="Database User Name:" labelWidth="150">
                <mx:TextInput id="databaseUserNameInput" fontWeight="normal" fontFamily="Lucida Grande" text="{userName}" width="350"/>
            </mx:FormItem>
            <mx:FormItem label="Database Password:" labelWidth="150">
                <mx:TextInput id="databasePasswordInput" fontWeight="normal" fontFamily="Lucida Grande" width="350" displayAsPassword="true"/>
            </mx:FormItem>
        </mx:Form>
        <mx:HRule width="100%"/>
        <mx:Form>
            <mx:FormItem label="Query:" labelWidth="150">
                <mx:TextArea id="queryArea" fontWeight="normal" fontFamily="Lucida Grande" width="350" text="{query}" height="110"
                        borderStyle="solid" borderThickness="1"/>
            </mx:FormItem>
        </mx:Form>
    </mx:VBox>
    <mx:VBox horizontalAlign="center">
        <mx:Text width="200" selectable="true" text="For the server side database connection to work, you'll need to open up your firewall to allow access on the database port to db.easy-insight.com (107.21.250.229). If you can't allow access through the firewall, you'll need to download and use the alternate database connection, hosting that behind your firewall."/>
        <mx:HRule width="100%"/>
        <mx:Text width="200" selectable="true" text="The query defines what fields and data to pull back into Easy Insight. For example, you might do 'select * from table_name', 'select a, b from table_name' or 'select a as A, b as B from table_name where X = Y'."/>
    </mx:VBox>
    <mx:HBox>
        <util:SaveButton label="Save" click="save()"/>
        <util:CancelButton label="Cancel" click="PopUpManager.removePopUp(this)"/>
    </mx:HBox>
    <mx:StringValidator id="hostValidator" minLength="1" source="{hostInput}" property="text"/>
    <mx:NumberValidator id="portValidator" source="{portInput}" property="text"/>
    <mx:StringValidator id="databaseNameValidator" minLength="1" source="{databaseNameInput}" property="text"/>
    <mx:StringValidator id="queryValidator" minLength="1" source="{queryArea}" property="text"/>
</feed:DataSourceWindow>