<?xml version="1.0" ?>
<feed:DataSourceWindow xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:util="com.easyinsight.util.*" width="100%"
                       height="100%"
                       xmlns:feed="com.easyinsight.administration.feed.*">
    <mx:Script><![CDATA[
        import com.easyinsight.administration.feed.FeedDefinitionData;
        import com.easyinsight.datasources.FreshbooksDataSource;
        import com.easyinsight.util.ProgressAlert;

        import mx.controls.Alert;
        import mx.managers.PopUpManager;

        [Bindable]
        private var url:String;
        [Bindable]
        private var liveDataSource:Boolean;

        private var feedDefinition:FeedDefinitionData;

        private function save():void {
            var ds:FreshbooksDataSource = feedDefinition as FreshbooksDataSource;
            ds.url = urlInput.text;
            ds.liveDataSource = liveDataSourceCheckbox.selected;
            saveSource();
        }


        override protected function gotSource():void {
            var ds:FreshbooksDataSource = feedDefinition as FreshbooksDataSource;
            this.feedDefinition = ds;
            url = ds.url;
            liveDataSource = ds.liveDataSource;
        }

        private function reauthorize():void {
            ProgressAlert.alert(this, "Authorizing...", null, tokenService.getOAuthURL);
            tokenService.getOAuthURL.send(feedDefinition.getFeedType(), true, null, feedDefinition, 2);
        }

        private function gotURL():void {
            var response:OAuthResponse = tokenService.getOAuthURL.lastResult as OAuthResponse;
            if (response.successful) {
                var requestToken:String = response.requestToken;
                navigateToURL(new URLRequest(requestToken), "_self");
            } else {
                Alert.show("We had a problem with authorization setup. Please contact support@easy-insight.com.");
            }
        }
        ]]></mx:Script>
    <mx:RemoteObject destination="tokenService" id="tokenService">
        <mx:method name="getOAuthURL" result="gotURL()"/>
    </mx:RemoteObject>
    <mx:Form paddingLeft="10" paddingRight="10" paddingTop="10" paddingBottom="10">
        <mx:FormItem label="FreshBooks URL:">
            <mx:TextInput id="urlInput" fontWeight="normal" fontFamily="Lucida Grande" text="{url}" width="350"/>
        </mx:FormItem>
        <mx:FormItem label="Live FreshBooks Connection:" direction="horizontal">
            <mx:CheckBox id="liveDataSourceCheckbox" selected="{liveDataSource}"/>
            <!--<mx:Label text="What is this?" fontSize="10" textDecoration="underline" toolTip="If you don't have a need to report on inactive projects, you can save time on your synchronization by not pulling those projects across into Easy Insight."/>-->
        </mx:FormItem>
	</mx:Form>
    <mx:HBox>
        <util:SaveButton label="Save" click="save()"/>
        <util:SaveButton label="Reauthorize Access" click="reauthorize()"/>
        <util:CancelButton label="Cancel" click="PopUpManager.removePopUp(this)"/>
    </mx:HBox>

</feed:DataSourceWindow>