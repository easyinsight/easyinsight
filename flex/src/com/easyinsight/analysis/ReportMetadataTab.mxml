<?xml version="1.0" ?>
<mx:Canvas label="Getting Started" icon="@Embed(source='../../../../assets/bullet_ball_green.png')" xmlns:mx="http://www.adobe.com/2006/mxml" creationComplete="onCreation()"
         xmlns:datasources="com.easyinsight.datasources.*" width="100%" height="90">
    <mx:Script><![CDATA[
        import com.easyinsight.datasources.DataSourceInfo;
        import com.easyinsight.filtering.TransformContainer;
        import com.easyinsight.framework.User;
        import com.easyinsight.suggestion.IntentionListWindow;
        import com.easyinsight.util.PopUpUtil;

        import mx.collections.ArrayCollection;

        import mx.managers.PopUpManager;

        private function onCreation():void {
            if (User.getInstance().guestUser) {
                removeChild(dataSourceDisplay);
            } else {
                dataSourceDisplay.visible = true;
            }
        }

        private var _dataView:DataViewFactory;

        [Bindable(event="dataViewChanged")]
        public function get dataView():DataViewFactory {
            return _dataView;
        }

        public function set dataView(value:DataViewFactory):void {
            if (_dataView == value) return;
            _dataView = value;
            dispatchEvent(new Event("dataViewChanged"));
        }


        private var _dataSourceInfo:DataSourceInfo;


        [Bindable(event="dataSourceInfoChanged")]
        public function get dataSourceInfo():DataSourceInfo {
            return _dataSourceInfo;
        }

        public function set dataSourceInfo(value:DataSourceInfo):void {
            if (_dataSourceInfo == value) return;
            _dataSourceInfo = value;
            dispatchEvent(new Event("dataSourceInfoChanged"));
        }

        private var _report:AnalysisDefinition;


        public function set report(value:AnalysisDefinition):void {
            _report = value;
        }

        private var _transformContainer:TransformContainer;


        public function set transformContainer(value:TransformContainer):void {
            _transformContainer = value;
        }

        public function cleanup():void {
        }

        private function tutorial():void {
            var window:ReportEditorHelp = new ReportEditorHelp();
            PopUpManager.addPopUp(window, this, true);
            PopUpUtil.centerPopUp(window);
        }

        private var _fields:ArrayCollection;

        public function set fields(value:ArrayCollection):void {
            _fields = value;
        }

        private var _availableFields:ArrayCollection;

        public function set availableFields(value:ArrayCollection):void {
            _availableFields = value;
        }

        private function suggestions():void {
            var items:ArrayCollection = new ArrayCollection();
            for each (var wrapper:AnalysisItemWrapper in _fields) {
                items.addItem(wrapper.analysisItem);
            }
            var window:IntentionListWindow = new IntentionListWindow();
            window.report = _report;
            window.fields = items;
            window.allFields = _availableFields;
            window.wrappers = _fields;
            window.transformContainer = _transformContainer;
            window.dataView = _dataView;
            PopUpManager.addPopUp(window, this, true);
            PopUpUtil.centerPopUp(window);
        }
        ]]></mx:Script>
    <mx:Box borderStyle="solid" borderThickness="1" cornerRadius="10" horizontalAlign="center" verticalAlign="middle"
                        backgroundColor="#FFFFFF" paddingBottom="5" paddingLeft="5" paddingRight="5" paddingTop="5" x="10" y="10">
        <mx:TextArea width="500" editable="false" selectable="false" borderStyle="none" backgroundAlpha="0" height="60" fontSize="14"
                                         text="You can drag the fields below into the report areas to the right. You can click on the arrow to the left of folders to see more fields. You can also right click on the fields to add to the report or create new filters."/>
    </mx:Box>
    <mx:Button icon="@Embed(source='../../../../assets/report/help.png')"
                       click="tutorial()" toolTip="Help!" label="Help!" x="575" y="5"/>
    <mx:Button icon="@Embed(source='../../../../assets/gear32.png')"
                       click="suggestions()" toolTip="Help!" label="Suggest Actions" x="542" y="45"/>
    <datasources:DataSourceDisplay dataSource="{dataSourceInfo}" dataView="{dataView}" id="dataSourceDisplay" visible="false" x="700" y="16" dataSourceRefreshed="dataView.forceRetrieve()"/>
</mx:Canvas>