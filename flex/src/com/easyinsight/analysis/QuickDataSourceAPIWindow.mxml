<?xml version="1.0" ?>
<util:EITitleWindow xmlns:util="com.easyinsight.util.*" xmlns:mx="http://www.adobe.com/2006/mxml" showCloseButton="true" close="PopUpManager.removePopUp(this)">
    <mx:Script><![CDATA[
        import com.easyinsight.account.AccountAPISettings;
        import com.easyinsight.customupload.api.DataSourceAPIDescriptor;

        import mx.managers.PopUpManager;

        [Bindable]
        private var apiKey:String;

        [Bindable]
        private var uncheckedEnabled:Boolean;

        [Bindable]
        private var validatedEnabled:Boolean;

        [Bindable]
        private var secretKey:String;

        [Bindable]
        private var key:String;

        [Bindable]
        private var secretKeyText:String = "Show Secret Key";

        [Bindable]
        private var showingSecretKey:Boolean = false;

        private var _dataSourceID:int;


        public function set dataSourceID(val:int):void {
            _dataSourceID = val;
        }

        override protected function commitProperties():void {
            super.commitProperties();
            apiService.getAPIDescriptor.send(_dataSourceID);
            userService.getUserAPISettings.send();
        }

        private function toggleSecret():void {
            if (showingSecretKey) {
                showingSecretKey = false;
                secretKeyText = "Show Secret Key";
            } else {
                showingSecretKey = true;
                secretKeyText = "Hide Secret Key";
            }
        }

        private function gotAPIInfo():void {
            var apiInfo:DataSourceAPIDescriptor = apiService.getAPIDescriptor.lastResult as DataSourceAPIDescriptor;
            apiKey = apiInfo.apiKey;
            uncheckedEnabled = apiInfo.uncheckedEnabled;
            validatedEnabled = apiInfo.validatedEnabled;
        }

        private function gotSettings():void {
            var accountAPISettings:AccountAPISettings = userService.getUserAPISettings.lastResult as AccountAPISettings;
            key = accountAPISettings.accountKey;
            secretKey = accountAPISettings.accountSecretKey;
        }
        ]]></mx:Script>
    <mx:RemoteObject id="apiService" destination="apiService">
        <mx:method name="getAPIDescriptor" result="gotAPIInfo()"/>
    </mx:RemoteObject>
    <mx:RemoteObject destination="login" id="userService">
        <mx:method name="getUserAPISettings" result="gotSettings()"/>
    </mx:RemoteObject>
    <mx:Form>
        <mx:FormItem label="User Key: " direction="horizontal">
            <mx:Label text="{key}"/>
            <mx:Button label="Copy to Clipboard" click="System.setClipboard(key)"/>
        </mx:FormItem>
        <mx:FormItem label="User Secret Key: " direction="horizontal">
            <mx:Button label="{secretKeyText}" />
            <mx:Label text="{secretKey}" visible="{showingSecretKey}"/>
            <mx:Button label="Copy to Clipboard" click="System.setClipboard(secretKey)" visible="{showingSecretKey}"/>
        </mx:FormItem>
        <mx:FormItem label="API Key: " direction="horizontal">
            <mx:Label text="{apiKey}"/>
            <mx:Button label="Copy to Clipboard" click="System.setClipboard(apiKey)"/>
        </mx:FormItem>
        <mx:FormItem label="Unchecked API Enabled: ">
            <mx:CheckBox id="uncheckedAPICheckbox" selected="{uncheckedEnabled}"/>
        </mx:FormItem>
        <mx:FormItem label="Validated API Enabled: ">
            <mx:CheckBox id="validatedAPICheckbox" selected="{validatedEnabled}"/>
        </mx:FormItem>
    </mx:Form>
</util:EITitleWindow>