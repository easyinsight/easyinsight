<?xml version="1.0"?>
<util:EISlimWindow xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:util="com.easyinsight.util.*"
        creationComplete="getDataSources()">
    <mx:Script><![CDATA[
        import com.easyinsight.util.ProgressAlert;

        import mx.collections.ArrayCollection;
        import mx.managers.PopUpManager;

        [Bindable]
        private var dataSources:ArrayCollection;

        private function gotDataSources():void {
            dataSources = feedService.searchForSubscribedFeeds.lastResult as ArrayCollection;
        }

        private function getDataSources():void {
            ProgressAlert.alert(this, "Retrieving data sources...", null, feedService.searchForSubscribedFeeds);
            feedService.searchForSubscribedFeeds.send();
        }

        public var report:AnalysisDefinition;

        private function copyReport():void {
            ProgressAlert.alert(this, "Copying the report...", null, analysisService.copyReport);
            analysisService.copyReport.send(report, dataSourceBox.selectedItem.id);
        }

        private function gotReport():void {
            var savedDef:AnalysisDefinition = analysisService.copyReport.lastResult as AnalysisDefinition;
            dispatchEvent(new SavedAnalysisEvent(savedDef));
            PopUpManager.removePopUp(this);
        }
        ]]></mx:Script>
    <mx:RemoteObject id="analysisService" destination="analysisDefinition">
        <mx:method name="copyReport" result="gotReport()"/>
    </mx:RemoteObject>
    <mx:RemoteObject id="feedService" destination="feedService">
        <mx:method name="searchForSubscribedFeeds" result="gotDataSources()"/>
    </mx:RemoteObject>
    <mx:ComboBox id="dataSourceBox" labelField="name"/>
    <mx:HBox width="100%" horizontalAlign="center">
        <util:SaveButton label="Copy the Report" click="copyReport()"/>
        <util:CancelButton label="Cancel" click="PopUpManager.removePopUp(this)"/>
    </mx:HBox>
</util:EISlimWindow>
