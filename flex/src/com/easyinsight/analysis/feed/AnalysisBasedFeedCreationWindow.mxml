<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" creationPolicy="all"
	creationComplete="initDef()">
	<mx:Script>
		<![CDATA[
			import com.easyinsight.administration.feed.FeedDefinitionData;
                    import mx.controls.Alert;
                    import com.easyinsight.framework.User;
                    import com.easyinsight.analysis.AnalysisDefinition;
                    import mx.rpc.events.FaultEvent;
                    import mx.rpc.events.ResultEvent;
                    import mx.managers.PopUpManager;

                    private var _analysisDefinition:AnalysisDefinition;
                    private var sourceFeedDefinition:FeedDefinitionData;

                    public function set analysisDefinition(analysisDefinition:AnalysisDefinition):void {
                        this._analysisDefinition = analysisDefinition;
                    }

                    public function get analysisDefinition():AnalysisDefinition {
                        return this._analysisDefinition;
                    }

                    private function create():void {
                        var feedDefinition:AnalysisBasedFeedDefinition = new AnalysisBasedFeedDefinition();
                        feedDefinition.feedName = feedName.text;
                        feedDefinition.analysisDefinitionID = _analysisDefinition.analysisID;
                        feedDefinition.genre = sourceFeedDefinition.genre;
                        feedDefinition.uploadPolicy = sourceFeedDefinition.uploadPolicy;                        
                        uploadService.createAnalysisBasedFeed.send(feedDefinition);
                    }

                    private function cancel():void {
                        PopUpManager.removePopUp(this);
                    }

                    private function createdFeed(event:ResultEvent):void {
                        PopUpManager.removePopUp(this);
                    }

                    private function failure(event:FaultEvent):void {
                        Alert.show(event.fault.message);
                    }

                    private function gotDataFeedInfo(event:ResultEvent):void {
                        sourceFeedDefinition = uploadService.getDataFeedConfiguration.lastResult as FeedDefinitionData;
                    }

                    private function initDef():void {
                        uploadService.getDataFeedConfiguration.send(_analysisDefinition.dataFeedID);
                    }
                ]]>
	</mx:Script>
	<mx:RemoteObject id="uploadService" destination="userUpload">
		<mx:method name="createAnalysisBasedFeed" result="createdFeed(event)" fault="failure(event)"/>
		<mx:method name="getDataFeedConfiguration" result="gotDataFeedInfo(event)" fault="failure(event)"/>
	</mx:RemoteObject>
	<mx:VBox>
		<mx:Form>
			<mx:FormItem label="New Feed Name:" direction="horizontal">
				<mx:TextInput id="feedName"/>
			</mx:FormItem>
			<mx:FormItem label="" direction="horizontal">
				<mx:Button label="Create" id="createButton" click="create()"/>
				<mx:Button label="Cancel" id="cancelButton" click="cancel()"/>
			</mx:FormItem>		
		</mx:Form>
	</mx:VBox>
</mx:TitleWindow>
