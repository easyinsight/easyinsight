<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" width="100%" height="100%">
	<mx:Script>
		<![CDATA[
			import com.easyinsight.images.ImageFactory;
			import mx.core.Container;
			import com.easyinsight.filtering.FilterRawData;
			import mx.collections.ArrayCollection;
            import com.easyinsight.framework.IDataService;

            public var analysisDefinition:AnalysisDefinition;
            [Bindable]
            public var dataService:IDataService;
            [Bindable]
            public var availableFields:ArrayCollection;
            [Bindable]
            public var showDropAreas:Boolean = true;
            
            public var showingDropAreas:Boolean = true;
            
            private var _draggable:Boolean = false;
            
            [Bindable]
            public function set draggable(draggable:Boolean):void {
            	this._draggable = draggable;
            }
            
            public function get draggable():Boolean {
            	return this._draggable;
            }

            public function getAnalysisDefinition():AnalysisDefinition {
                return analysisDefinition;
            }

            public function invalidateItems(items:ArrayCollection):void {

            }
            
            public function set subState(subState:int):void {
            	
            }

            public function createFilterRawData():FilterRawData {
                return null;
            }

            public function search(keyword:String):void {

            }
            
            public function getCoreView():DisplayObject {
            	return null;
            }

            /*protected function retrieveDataItem(key:String):DataFeedItem {
                for (var i:int = 0; i < availableFields.length; i++) {
                    var dataFeedItem:DataFeedItem = availableFields.getItemAt(i) as DataFeedItem;
                    if (dataFeedItem.key == key) {
                        return dataFeedItem;
                    }
                }
                return null;
            }*/

            public function updateExportMetadata():void {
                
            }

            public function fromExistingDefinition(existingDefinition:AnalysisDefinition):AnalysisDefinition {
                var newDefinition:AnalysisDefinition = null;
                if (existingDefinition.getDataFeedType() == "Crosstab") {
                    newDefinition = fromCrosstabDefinition(existingDefinition as CrosstabDefinition);
                } else if (existingDefinition.getDataFeedType() == "List") {
                    newDefinition = fromListDefinition(existingDefinition as ListDefinition);
                } else if (existingDefinition.getDataFeedType() == "Chart") {
                    newDefinition = fromGraphicDefinition(existingDefinition as GraphicDefinition);
                } else if (existingDefinition.getDataFeedType() == "Map") {
                	newDefinition = fromMapDefinition(existingDefinition as MapDefinition);
                } else if (existingDefinition.getDataFeedType() == "YahooMap") {
                	newDefinition = fromYahooMapDefinition(existingDefinition as YahooMapDefinition);
                } else if (existingDefinition.getDataFeedType() == "Split") {
                	newDefinition = fromSplitDefinition(existingDefinition as SplitDefinition);
                }
                copyStandardData(existingDefinition, newDefinition);
                return newDefinition;
            }

            public function initializeToDefinition():void {

            }

            public function requestData():void {
            }

            protected function fromCrosstabDefinition(crosstabDefinition:CrosstabDefinition):AnalysisDefinition {
                return null;
            }

            protected function fromListDefinition(listDefinition:ListDefinition):AnalysisDefinition {
                return null;
            }

            protected function fromGraphicDefinition(graphicDefinition:GraphicDefinition):AnalysisDefinition {
                return null;
            }
            
            protected function fromMapDefinition(mapDefinition:MapDefinition):AnalysisDefinition {
            	return null;
            }
            
            protected function fromYahooMapDefinition(yahooMapDefinition:YahooMapDefinition):AnalysisDefinition {
            	return null;
            }
            
            protected function fromSplitDefinition(splitDefinition:SplitDefinition):AnalysisDefinition {
            	return fromExistingDefinition(splitDefinition.targetDefinition);
            }

            public function createNewDefinition():AnalysisDefinition {
                return null;
            }
            
            protected function copyStandardData(source:AnalysisDefinition, target:AnalysisDefinition):void {
            	target.name = source.name;
            	target.dataFeedID = source.dataFeedID;
            	target.analysisID = source.analysisID;
            	target.tagCloud = source.tagCloud;
            	target.dataScrubs = source.dataScrubs;
            	target.dateCreated = source.dateCreated;
            	target.filterDefinitions = source.filterDefinitions;
            	target.policy = source.policy;
            	target.addedItems = source.addedItems;
                target.hierarchies = source.hierarchies;
            	target.viewCount = source.viewCount;
            	target.ratingCount = source.ratingCount;
            	target.ratingAverage = source.ratingAverage;
            	target.canSaveDirectly = source.canSaveDirectly;                    	
            }
            
            public function findDateItem():AnalysisItem {
            	for each (var analysisWrapper:AnalysisItemWrapper in availableFields) {
            		if (analysisWrapper.analysisItem.hasType(AnalysisItemTypes.DATE)) {
            			return analysisWrapper.analysisItem;
            		}
            	}
            	return null;
            }
        ]]>
	</mx:Script>
</mx:VBox>
