<?xml version="1.0"?>
<mx:Module xmlns:mx="http://www.adobe.com/2006/mxml"
           implements="com.easyinsight.analysis.IReportRenderer" width="100%" height="100%">
    <mx:Script><![CDATA[
        import com.easyinsight.analysis.AnalysisDefinition;

        import com.easyinsight.analysis.AnalysisItem;
        import com.easyinsight.analysis.CustomChangeEvent;
        import com.easyinsight.filtering.FilterRawData;

        import mx.collections.ArrayCollection;
        import mx.containers.Form;
        import mx.containers.FormItem;
        import mx.containers.HBox;
        import mx.containers.VBox;
        import mx.controls.Alert;
        import mx.core.UIComponent;

        public function renderReport(dataSet:ArrayCollection, analysisDefinition:AnalysisDefinition, clientProcessorMap:Object, additionalProperties:Object):void {
            var formReport:FormReport = analysisDefinition as FormReport;
            //setStyle("backgroundAlpha", formReport.backgroundAlpha);
            removeAllChildren();
            if (dataSet.length == 0) {

            } else if (dataSet.length == 1) {
                addChild(createForm(dataSet.getItemAt(0), formReport));
            } else {
                var pages:FormPages = new FormPages();
                pages.values = dataSet;
                pages.formReport = formReport;
                addChild(pages);
            }
        }

        private function createForm(row:Object, formReport:FormReport):UIComponent {
            var hbox:HBox = new HBox();
            hbox.percentHeight = 100;
            hbox.percentWidth = 100;
            var fieldsPerColumn:int = formReport.columns.length / formReport.columnCount;
            var remainder:int = formReport.columns.length % formReport.columnCount;
            var l:int = 0;
            for (var i:int = 0; i < formReport.columnCount; i++) {
                if (formReport.direction == "Left") {

                    var form:Form = new Form();

                    for (var j:int = 0; j < (fieldsPerColumn + (i == 0 ? remainder : 0)); j++) {
                        var item:AnalysisItem = formReport.columns.getItemAt(l++) as AnalysisItem;
                        var formItem:FormItem = new FormItem();
                        formItem.setStyle("fontWeight", "normal");
                        formItem.setStyle("fontSize", formReport.labelFontSize);
                        formItem.setStyle("fontFamily", formReport.getFont());

                        formItem.label = item.display + ":";

                        var renderer:FormCellRenderer = new FormCellRenderer();
                        renderer.analysisItem = item;
                        renderer.report = formReport;
                        renderer.data = row;
                        formItem.addChild(renderer);

                        form.addChild(formItem);
                    }
                    hbox.addChild(form);
                } else if (formReport.direction == "Bottom" || formReport.direction == "Top") {
                    var vbox:VBox = new VBox();
                    for (var k:int = 0; k < (fieldsPerColumn + (i == 0 ? remainder : 0)); k++) {
                        var xItem:AnalysisItem = formReport.columns.getItemAt(l++) as AnalysisItem;
                        var vRenderer:VerticalFormCellRenderer = new VerticalFormCellRenderer();
                        vRenderer.analysisItem = xItem;
                        vRenderer.report = formReport;
                        vRenderer.labelTop = formReport.direction == "Top";
                        vRenderer.data = row;
                        vbox.addChild(vRenderer);
                    }
                    hbox.addChild(vbox);
                }
            }
            return hbox;
        }

        public function createFilterRawData():FilterRawData {
            return null;
        }

        public function updateExportMetadata():void {
        }

        public function onCustomChangeEvent(event:CustomChangeEvent):void {
        }

        public function preserveValues():Boolean {
            return true;
        }]]></mx:Script>
</mx:Module>
