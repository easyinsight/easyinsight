<?xml version="1.0" ?>
<util:EITitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:util="com.easyinsight.util.*"
        paddingLeft="5" paddingBottom="5" paddingRight="5" paddingTop="5" backgroundColor="#FFFFFF">
    <mx:Script><![CDATA[
        import com.easyinsight.account.Account;
        import com.easyinsight.framework.User;

        import mx.controls.Alert;
        import mx.managers.PopUpManager;

        private var _errorMessage:String;

        private var _stackTrace:String;

        [Bindable(event="errorMessageChanged")]
        public function get errorMessage():String {
            return _errorMessage;
        }

        public function set errorMessage(value:String):void {
            if (_errorMessage == value) return;
            _errorMessage = value;
            dispatchEvent(new Event("errorMessageChanged"));
        }

        [Bindable(event="stackTraceChanged")]
        public function get stackTrace():String {
            return _stackTrace;
        }

        public function set stackTrace(value:String):void {
            if (_stackTrace == value) return;
            _stackTrace = value;
            dispatchEvent(new Event("stackTraceChanged"));
        }

        [Bindable]
        private var index:int;

        protected override function commitProperties():void {
            super.commitProperties();
            try {
                if (_error != null) {
                    errorMessage = _error.message + " " + _error.name;
                    stackTrace = _error.getStackTrace();
                }
            } catch(e:Error) {
            }
        }

        private var _error:Error;

        public function set error(value:Error):void {
            _error = value;
        }

        private function reported():void {
            PopUpManager.removePopUp(this);
        }

        private function toDetail():void {
            if (User.getInstance() != null && User.getInstance().getAccountType() == Account.ADMINISTRATOR) {
                index = 2;
            } else {
                index = 2;
            }
        }
    ]]>
    </mx:Script>
    <mx:ViewStack resizeToContent="true" selectedIndex="{index}" addedToStage="PopUpUtil.centerPopUp(this)">
        <mx:VBox horizontalAlign="center">
            <mx:Label text="Oops, something went wrong!" fontSize="20"/>
            <mx:Button label="Show Error Details" fontSize="12" click="toDetail()"/>
            <mx:HBox width="100%" horizontalAlign="center">
                <mx:Button label="Close" fontSize="14" click="PopUpManager.removePopUp(this)"/>
            </mx:HBox>
        </mx:VBox>
        <mx:VBox horizontalAlign="center" creationComplete="PopUpUtil.centerPopUp(this)">
            <mx:Text text="{errorMessage}" fontSize="14" selectable="true"/>
            <mx:Button label="Hide Error Details" fontSize="12" click="index = 0"/>
            <mx:HBox width="100%" horizontalAlign="center">
                <mx:Button label="Close" fontSize="14" click="PopUpManager.removePopUp(this)"/>
            </mx:HBox>
        </mx:VBox>
        <mx:VBox horizontalAlign="center" creationComplete="PopUpUtil.centerPopUp(this)">
            <mx:Text text="{errorMessage}" fontSize="14" selectable="true"/>
            <mx:TextArea text="{stackTrace}" width="700" height="200" editable="false" selectable="true"
                    borderStyle="inset" borderThickness="1"/>
            <mx:Button label="Hide Error Details" fontSize="12" click="index = 0"/>
            <mx:HBox width="100%" horizontalAlign="center">
                <mx:Button label="Close" fontSize="14" click="PopUpManager.removePopUp(this)"/>
            </mx:HBox>
        </mx:VBox>
    </mx:ViewStack>
</util:EITitleWindow>