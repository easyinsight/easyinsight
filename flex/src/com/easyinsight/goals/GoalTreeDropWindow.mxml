<?xml version="1.0" ?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" backgroundColor="#DCE2F8" borderThickness="1" cornerRadius="15" dropShadowEnabled="true"
        creationComplete="addTree()">
    <mx:Script><![CDATA[
        import com.easyinsight.solutions.Solution;

        import mx.managers.PopUpManager;

        private var _goalTreeNode:GoalTreeNode;
        private var _goalTreeDescriptor:GoalTreeDescriptor;

        private var goalTree:GoalTree;

        private function addTree():void {
            goalService.getGoalTree.send(_goalTreeDescriptor.id);
        }

        private function addInline():void {
            var rootNode:GoalTreeNode = goalTree.rootNode;
            var clonedNode:GoalTreeNode = rootNode.clone();
            clonedNode.parent = _goalTreeNode;
            _goalTreeNode.children.addItem(clonedNode);
            if (_goalTreeDescriptor is SolutionGoalTreeDescriptor) {
                dispatchEvent(new SolutionInstallRequiredEvent(SolutionInstallRequiredEvent.SOLUTION_INSTALL, _goalTreeDescriptor as SolutionGoalTreeDescriptor));
            }
            dispatchEvent(new OrganizationChartRefreshEvent());
            PopUpManager.removePopUp(this);
        }

        private function gotGoalTree():void {
            goalTree = goalService.getGoalTree.lastResult as GoalTree;
            coreBox.enabled = true;
        }

        private function addSubTree():void {
            _goalTreeNode.subTreeID = _goalTreeDescriptor.id;
            _goalTreeNode.subTreeName = _goalTreeDescriptor.name;
            if (_goalTreeDescriptor is SolutionGoalTreeDescriptor) {
                _goalTreeNode.newSubTree = _goalTreeDescriptor as SolutionGoalTreeDescriptor;
            }
            dispatchEvent(new SubTreeInstallEvent(SubTreeInstallEvent.SUB_TREE_INSTALL, _goalTreeDescriptor.id));
            PopUpManager.removePopUp(this);
        }

        public function set goalTreeNode(val:GoalTreeNode):void {
            _goalTreeNode = val;
        }

        public function set goalTreeDescriptor(val:GoalTreeDescriptor):void {
            _goalTreeDescriptor = val;
        }

        public function set solution(val:Solution):void {
            //_solution = val;
        }]]></mx:Script>
    <mx:RemoteObject destination="goalService" id="goalService">
        <mx:method name="getGoalTree" result="gotGoalTree()"/>
    </mx:RemoteObject>
    <mx:VBox id="coreBox" enabled="false">
        <mx:Label text="Do you want to add this goal tree inline or as a sub tree?"/>
        <mx:HBox width="100%" horizontalAlign="center">
            <mx:Button label="Add inline" click="addInline()"/>
            <mx:Button label="Add as a sub tree" click="addSubTree()"/>
        </mx:HBox>
    </mx:VBox>
</mx:Canvas>