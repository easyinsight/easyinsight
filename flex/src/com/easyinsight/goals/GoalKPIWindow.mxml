<?xml version="1.0" ?>
<util:EITitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:util="com.easyinsight.util.*">
    <mx:Script><![CDATA[
        import com.easyinsight.kpi.KPI;
        import com.easyinsight.kpi.KPIEvent;
        import com.easyinsight.kpi.KPIWindow;
        import com.easyinsight.util.PopUpUtil;

        import mx.managers.PopUpManager;

        [Bindable]
        private var kpiName:String;

        private var kpi:KPI;

        private var _goalTreeNode:GoalTreeNode;

        [Bindable]
        private var kpiIndex:int = 0;

        [Bindable]
        [Embed(source="../../../../assets/navigate_cross.png")]
        private var deleteIcon:Class;

        public function set goalTreeNode(value:GoalTreeNode):void {
            _goalTreeNode = value;
            kpi = _goalTreeNode.kpi;
            if (_goalTreeNode.kpi == null) {
                kpiIndex = 0;
            } else {
                kpiName = _goalTreeNode.kpi.name;
                kpiIndex = 1;
            }
        }

        private function deleteKPI():void {
            kpi = null;
            kpiIndex = 0;
        }

        private function newKPI():void {
            var kpiWindow:KPIWindow = new KPIWindow();            
            kpiWindow.addEventListener(KPIEvent.KPI_ADDED, addedKPI);
            PopUpManager.addPopUp(kpiWindow, this, true);
            PopUpUtil.centerPopUp(kpiWindow);
        }

        private function save():void {
            _goalTreeNode.kpi = kpi;
            _goalTreeNode.name = _goalTreeNode.kpi.name;
        }

        private function addedKPI(event:KPIEvent):void {
            kpi = event.kpi;
            kpiName = _goalTreeNode.kpi.name;
            kpiIndex = 1;
        }
        ]]></mx:Script>
    <mx:ViewStack selectedIndex="{kpiIndex}">
        <mx:VBox>
            <mx:Button label="Create a new KPI" click="newKPI()"/>
            <mx:HBox width="100%" horizontalAlign="center">
                <mx:Button label="Save" click="save()"/>
                <mx:Button label="Cancel" click="PopUpManager.removePopUp(this)"/>
            </mx:HBox>
        </mx:VBox>
        <mx:VBox>
            <mx:Form>
                <mx:FormItem label="Assigned KPI Name:" direction="horizontal">
                    <mx:Label text="{kpiName}"/>
                    <mx:Button icon="{deleteIcon}" click="deleteKPI()"/>
                </mx:FormItem>
                
            </mx:Form>
            <mx:HBox>
                <mx:Button label="Save" click="save()"/>
                <mx:Button label="Cancel" click="PopUpManager.removePopUp(this)"/>
            </mx:HBox>
        </mx:VBox>
    </mx:ViewStack>
</util:EITitleWindow>