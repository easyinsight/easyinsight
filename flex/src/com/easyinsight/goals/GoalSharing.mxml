<?xml version="1.0" ?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" creationComplete="initHandlers()">
    	<mx:Script>
		<![CDATA[
            import com.easyinsight.administration.feed.GroupLinkEvent;
            import com.easyinsight.administration.feed.UserLinkEvent;
            import com.easyinsight.administration.feed.AddGroupToFeedWindow;
            import com.easyinsight.administration.feed.AddUserToFeedWindow;

            import com.easyinsight.util.PopUpUtil;

            import mx.managers.PopUpManager;

            import mx.collections.ArrayCollection;

            [Bindable]
            [Embed(source="../../../../assets/user_add.png")]
            public var addUserIcon:Class;

            [Bindable]
            [Embed(source="../../../../assets/users4_add_x32.png")]
            public var addGroupIcon:Class;

            [Bindable]
            private var owners:ArrayCollection;
            [Bindable]
            private var viewers:ArrayCollection;

            private var _goalTree:GoalTree;


            public function set goalTree(val:GoalTree):void {
                _goalTree = val;
                owners = _goalTree.administrators;
                viewers = _goalTree.consumers;
            }

            private function initHandlers():void {
                ownersGrid.addEventListener(UserLinkEvent.DELETE_USER_LINK, deletedOwner);
                viewersGrid.addEventListener(UserLinkEvent.DELETE_USER_LINK, deletedViewer);
            }

            private function deletedOwner(event:UserLinkEvent):void {
                owners.removeItemAt(owners.getItemIndex(event.userStub));
            }

            private function deletedViewer(event:UserLinkEvent):void {
                viewers.removeItemAt(viewers.getItemIndex(event.userStub));
            }

            public function updateContents():void {
                _goalTree.administrators = ownersGrid.dataProvider as ArrayCollection;
                _goalTree.consumers = viewersGrid.dataProvider as ArrayCollection;
            }

            private function addGroupOwner():void {
                var window:AddGroupToFeedWindow = AddGroupToFeedWindow(PopUpManager.createPopUp(this, AddGroupToFeedWindow, true));
                window.addEventListener(GroupLinkEvent.ADD_GROUP_LINK, onGroupOwnerAdd);
                PopUpUtil.centerPopUp(window);
            }

            private function onGroupOwnerAdd(event:GroupLinkEvent):void {
                owners.addItem(event.groupDescriptor);
            }

            private function addUserOwner():void {
                var window:AddUserToFeedWindow = AddUserToFeedWindow(PopUpManager.createPopUp(this, AddUserToFeedWindow, true));
                window.addEventListener(UserLinkEvent.ADD_USER_LINK, onUserOwnerAdd);
                PopUpUtil.centerPopUp(window);
            }

            private function onUserOwnerAdd(event:UserLinkEvent):void {
                owners.addItem(event.userStub);
            }

            private function addUserViewer():void {
                var window:AddUserToFeedWindow = AddUserToFeedWindow(PopUpManager.createPopUp(this.parent.parent, AddUserToFeedWindow, true));
                window.addEventListener(UserLinkEvent.ADD_USER_LINK, onUserViewerAdd);
                PopUpUtil.centerPopUp(window);
            }

            private function onUserViewerAdd(event:UserLinkEvent):void {
                viewers.addItem(event.userStub);
            }

            private function addGroupViewer():void {
                var window:AddGroupToFeedWindow = AddGroupToFeedWindow(PopUpManager.createPopUp(this, AddGroupToFeedWindow, true));
                window.addEventListener(GroupLinkEvent.ADD_GROUP_LINK, onGroupViewerAdd);
                PopUpUtil.centerPopUp(window);
            }

            private function onGroupViewerAdd(event:GroupLinkEvent):void {
                viewers.addItem(event.groupDescriptor);
            }
		]]>
	</mx:Script>
	<mx:HBox>
		<mx:VBox>
			<mx:HBox width="100%">
				<mx:Label text="Owners"/>
			</mx:HBox>
			<mx:HBox>
				<mx:Button toolTip="Add User" icon="{addUserIcon}" click="addUserOwner()"/>
				<mx:Button toolTip="Add Group" icon="{addGroupIcon}" click="addGroupOwner()"/>
			</mx:HBox>
			<mx:DataGrid dataProvider="{owners}" dragMoveEnabled="true" id="ownersGrid">
				<mx:columns>
					<mx:DataGridColumn headerText="Type" dataField="name" itemRenderer="com.easyinsight.administration.feed.FeedConsumerRenderer"/>
					<mx:DataGridColumn headerText="Name" dataField="name"/>
					<mx:DataGridColumn headerText="" dataField="userName" width="64"
						itemRenderer="com.easyinsight.administration.feed.DeleteUserButton"/>
				</mx:columns>
			</mx:DataGrid>
		</mx:VBox>
		<mx:Spacer width="20"/>
		<mx:VBox>
			<mx:HBox width="100%">
				<mx:Label text="Viewers"/>
			</mx:HBox>
			<mx:HBox>
				<mx:Button toolTip="Add User" icon="{addUserIcon}" click="addUserViewer()"/>
				<mx:Button toolTip="Add Group" icon="{addGroupIcon}" click="addGroupViewer()"/>
			</mx:HBox>
			<mx:DataGrid dataProvider="{viewers}" dragMoveEnabled="true" id="viewersGrid">
				<mx:columns>
					<mx:DataGridColumn headerText="Type" dataField="name" itemRenderer="com.easyinsight.administration.feed.FeedConsumerRenderer"/>
					<mx:DataGridColumn headerText="Name" dataField="name"/>
					<mx:DataGridColumn headerText="" dataField="userName" width="64"
						itemRenderer="com.easyinsight.administration.feed.DeleteUserButton"/>
				</mx:columns>
			</mx:DataGrid>
		</mx:VBox>
	</mx:HBox>
</mx:VBox>