<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" title="Save Insight" 
	creationComplete="addEventListener(KeyboardEvent.KEY_UP, keyHit); focusManager.setFocus(analysisName)">
	<mx:Script>
		<![CDATA[
			import com.easyinsight.analysis.ListDefinition;
                    import com.easyinsight.analysis.SavedAnalysisEvent;
                    import com.easyinsight.analysis.CrosstabDefinition;
                    import com.easyinsight.analysis.ChartDefinition;
                    import mx.managers.PopUpManager;
                    import com.easyinsight.analysis.AnalysisDefinition;

                    [Bindable]
                    public var analysisDefinition:AnalysisDefinition;

                    private function save():void {
                        analysisDefinition.name = analysisName.text;
                        analysisService.saveAnalysisDefinition(analysisDefinition);
                        dispatchEvent(new SavedAnalysisEvent(analysisName.text));
                        PopUpManager.removePopUp(this);
                    }
                    
                    private function keyHit(event:KeyboardEvent):void {
                    	if (event.keyCode == Keyboard.ENTER) {
                    		save();
                    	}
                    }

                    private function cancel():void {
                        PopUpManager.removePopUp(this);
                    }

                    private function saved():void {
                    	analysisDefinition.analysisID = analysisService.saveAnalysisDefinition.lastResult as int;
                        PopUpManager.removePopUp(this);
                    }
                ]]>
	</mx:Script>
	<mx:VBox styleName="TitleWindowContents" width="100%" height="100%">			
		<mx:Form>
			<mx:FormItem label="Insight Name:" direction="horizontal">
				<mx:TextInput id="analysisName"/>				
			</mx:FormItem>
			<mx:FormItem label="" direction="horizontal">
				<mx:Button label="Save" click="save()"/>
				<mx:Button label="Cancel" click="cancel()"/>	
			</mx:FormItem>		
		</mx:Form>		
	</mx:VBox>
	<mx:StringValidator source="{analysisName}" property="text" minLength="3"/> 
	<mx:RemoteObject id="analysisService" destination="analysisDefinition">
		<mx:method name="saveAnalysisDefinition" result="saved()"/>
	</mx:RemoteObject>
</mx:TitleWindow>