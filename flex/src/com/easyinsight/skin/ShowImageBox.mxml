<?xml version="1.0"?>
<mx:Box xmlns:mx="http://www.adobe.com/2006/mxml" minHeight="40" minWidth="40" creationComplete="onCreation()" borderStyle="solid"
        borderThickness="1" borderColor="#333333">
    <mx:Script><![CDATA[
        import com.easyinsight.util.PopUpUtil;

        import mx.managers.PopUpManager;

        [Bindable]
        private var imageName:String;

        private var _imageDescriptor:ImageDescriptor;
        
        private function onCreation():void {
            addEventListener(MouseEvent.CLICK, onClick);
        }

        private function onClick(event:MouseEvent):void {
            var window:ExistingImageWindow = new ExistingImageWindow();
            window.addEventListener(ImageUploadEvent.IMAGE_UPLOAD, onImageUpload, false, 0, true);
            PopUpManager.addPopUp(window, this, true);
            PopUpUtil.centerPopUp(window);
        }

        [Bindable(event="imageDescriptorChanged")]
        public function get imageDescriptor():ImageDescriptor {
            return _imageDescriptor;
        }

        public function set imageDescriptor(value:ImageDescriptor):void {
            if (_imageDescriptor == value) return;
            _imageDescriptor = value;
            invalidateProperties();
            dispatchEvent(new Event("imageDescriptorChanged"));
        }

        public var publicImage:Boolean;

        private function onImageUpload(event:ImageUploadEvent):void {
            var desc:ImageDescriptor = event.imageDescriptor;
            imageName = desc.name;
            this.imageDescriptor = desc;
            invalidateProperties();
            dispatchEvent(event);
        }

        private function onDelete():void {
            imageName = "( No Image )";
            imageDescriptor = null;
        }

        protected override function commitProperties():void {
            super.commitProperties();
            if (_imageDescriptor == null) {

            } else {
                var headerBarLoader:ImageLoader = new ImageLoader();
                headerBarLoader.addEventListener(ImageLoadEvent.IMAGE_LOADED, function(event:ImageLoadEvent):void {
                    image.source = event.bitmap;
                });
                headerBarLoader.load(_imageDescriptor.id);
            }
        }
        ]]></mx:Script>
    <mx:Image id="image" mouseEnabled="false" maxHeight="200"/>
</mx:Box>
