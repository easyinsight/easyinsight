<?xml version="1.0" ?>
<genredata:ExchangePage xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:genredata="com.easyinsight.genredata.*"
                        xmlns:listing="com.easyinsight.listing.*" width="100%" height="100%">
    <mx:Script><![CDATA[
        import mx.collections.Sort;
        import mx.collections.SortField;

        private function onTagFocus(event:TagFocusEvent):void {
            selectedTag = event.tag;
        }

        [Bindable]
        private var _itemRenderer:IFactory;

        public function set itemRenderer(value:IFactory):void {
            _itemRenderer = value;
        }

        private function changeSort():void {
            var index:int = sortBox.selectedIndex;
            var sort:Sort = new Sort();
            var sortField:SortField = new SortField();
            if (index == 0) {
                sortField.name = "installs";
                sortField.descending = true;
            } else if (index == 1) {
                sortField.name = "installs";
                sortField.descending = false;
            } else if (index == 2) {
                sortField.name = "dateAdded";
                sortField.descending = true;
            } else if (index == 3) {
                sortField.name = "dateAdded";
                sortField.descending = false;
            }
            sort.fields = [ sortField ];
            dataProvider2.sort = sort;
            dataProvider2.refresh();
        }

        [Bindable]
        private var stackIndex:int;

        override protected function commitProperties():void {
            super.commitProperties();
            if (loading) {
                stackIndex = 0;
            } else {
                stackIndex = 1;                
            }
        }
        ]]>
    </mx:Script>
    <mx:HBox width="100%" height="100%" id="listsBox">
        <mx:VBox height="100%">
            <mx:HBox>

                <mx:Label text="Sort By:" fontFamily="Tahoma" fontWeight="bold" fontSize="14"/>
                <mx:ComboBox id="sortBox" change="changeSort()">
                    <mx:dataProvider>
                        <mx:ArrayCollection>
                            <mx:Array>
                                <mx:String>Rating (Best)</mx:String>
                                <mx:String>Rating (Worst)</mx:String>
                                <mx:String>Date Added (Newest)</mx:String>
                                <mx:String>Date Added (Oldest)</mx:String>
                            </mx:Array>
                        </mx:ArrayCollection>
                    </mx:dataProvider>
                </mx:ComboBox>

            </mx:HBox>
            <mx:Spacer height="30"/>
            <mx:HBox width="100%" horizontalAlign="center">
                <mx:Label text="Popular Tags" fontFamily="Tahoma" fontWeight="bold" fontSize="14"/>
            </mx:HBox>
            <listing:TagListing width="250" borderStyle="solid" borderThickness="1" tagFocus="onTagFocus(event)" height="100%"/>
        </mx:VBox>
        <mx:Box width="100%" horizontalAlign="center" height="100%">
            <!--<mx:Canvas backgroundAlpha="0" width="100%" height="100%">-->
            <mx:ViewStack width="100%" height="100%" selectedIndex="{stackIndex}">
                <mx:Box width="100%" height="100%" horizontalAlign="center" verticalAlign="middle">
                    <mx:ProgressBar indeterminate="{stackIndex == 0}" label="Loading the available reports..."/>
                </mx:Box>
                <mx:Box width="100%" height="100%">
                    <mx:List dataProvider="{dataProvider2}" itemRenderer="{_itemRenderer}" height="100%" width="100%"
                        backgroundAlpha="0" borderStyle="none"/>
                </mx:Box>
            </mx:ViewStack>
            <!--</mx:Canvas>-->
        </mx:Box>
    </mx:HBox>
</genredata:ExchangePage>