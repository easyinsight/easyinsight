<?xml version="1.0" ?>
<util:EITitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:util="com.easyinsight.util.*">
    <mx:Script><![CDATA[
        import com.easyinsight.analysis.AnalysisDefinition;
        import com.easyinsight.analysis.ExcelCreator;
        import com.easyinsight.analysis.PNGCreator;

        import mx.collections.ArrayCollection;
        import mx.managers.PopUpManager;

        private var _reportID:int;
        private var _reportType:int;
        private var _dataSourceID:int;
        private var _reportName:String;
        private var _filterDefinitions:ArrayCollection;
        private var _embeddedFilters:ArrayCollection;
        private var _hierarchyOverrides:ArrayCollection;
        private var _coreView:DisplayObject;

        private var _report:AnalysisDefinition;

        public function set report(value:AnalysisDefinition):void {
            _report = value;
        }

        public function set coreView(value:DisplayObject):void {
            _coreView = value;
        }

        public function set reportType(value:int):void {
            _reportType = value;
        }

        public function set dataSourceID(value:int):void {
            _dataSourceID = value;
        }

        public function set reportName(value:String):void {
            _reportName = value;
        }

        public function set filterDefinitions(value:ArrayCollection):void {
            _filterDefinitions = value;
        }

        public function set embeddedFilters(value:ArrayCollection):void {
            _embeddedFilters = value;
        }

        public function set hierarchyOverrides(value:ArrayCollection):void {
            _hierarchyOverrides = value;
        }

        public function set reportID(value:int):void {
            _reportID = value;
        }

        private function excel():void {
            new ExcelCreator().exportExcel(_report, this);
            PopUpManager.removePopUp(this);
        }

        private function csv():void {

        }

        private function png():void {
            new PNGCreator().draw(_coreView);
            PopUpManager.removePopUp(this);
        }

        private function url():void {
            var escapedName:String = _reportName.replace(/[ @\"&*#$%^~]/g, "-");
            var url:String = "https://www.easy-insight.com/reports/" + escapedName + "-" + _reportID;
            var urlWindow:URLWindow = new URLWindow();
            urlWindow.x = this.x;
            urlWindow.y = this.y;
            urlWindow.url = url;
            PopUpManager.addPopUp(urlWindow, this, true);
            PopUpManager.removePopUp(this);
        }

        private function embed():void {
            var _reportWidth:int = 600;
            var _reportHeight:int = 500;
            var url:String = "<object width=\"" + _reportWidth + "\" height=\"" + _reportHeight + "\" codebase=\"http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab\"><param name=\"movie\" value=\"EmbeddedInsight.swf\" /><param name=\"quality\" value=\"high\" /><param name=\"bgcolor\" value=\"#869ca7\" /><param name=\"allowScriptAccess\" value=\"always\" /> <param name=\"flashvars\" value=\"analysisID=" + _reportID + "&reportType=" + _reportType + "&dataSourceID=" + _dataSourceID + "&reportName=" + escape(_reportName) + "\"/> <embed src=\"https://www.easy-insight.com/app/easyui-debug/EmbeddedInsight.swf\" quality=\"high\" bgcolor=\"##869ca7\" width=\"" + _reportWidth + "\" height=\"" + _reportHeight + "\" name=\"PrimaryWorkspace\" align=\"middle\" play=\"true\" loop=\"false\" quality=\"high\" allowScriptAccess=\"always\" flashvars=\"analysisID=" + _reportID + "&reportType=" + _reportType + "&dataSourceID=" + _dataSourceID + "&reportName=" + escape(_reportName) + "\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.adobe.com/go/getflashplayer\"></embed></object>";
            var urlWindow:URLWindow = new URLWindow();
            urlWindow.x = this.x;
            urlWindow.y = this.y;
            urlWindow.url = url;
            PopUpManager.addPopUp(urlWindow, this, true);
            PopUpManager.removePopUp(this);
        }

        private function netvibes():void {
            navigateToURL(new URLRequest("http://www.netvibes.com/subscribe.php?module=UWA&moduleUrl=" + escape("https://www.easy-insight.com/app/widgets/UWAWidget.html?insightCombo=" + escape(String(_reportID)) + "&reportName=" + escape(_reportName) + "&reportType=" + escape(String(_reportType)) + "&dataSourceID=" + escape(String(_dataSourceID)))));
            PopUpManager.removePopUp(this);
        }

        private function igoogle():void {
            navigateToURL(new URLRequest("http://www.google.com/ig/add?moduleurl=" + escape("http://www.netvibes.com/api/uwa/compile/google.php?moduleUrl=" + escape("https://www.easy-insight.com/app/widgets/UWAWidget.html?insightCombo=" + escape(String(_reportID)) + "&reportName=" + escape(_reportName) + "&reportType=" + escape(String(_reportType)) + "&dataSourceID=" + escape(String(_dataSourceID))))));
            PopUpManager.removePopUp(this);
        }
        ]]></mx:Script>
    <mx:VBox paddingTop="5" paddingLeft="5" paddingBottom="5" paddingRight="5" horizontalAlign="center">
        <mx:Label text="Click any of the options below to export the report:"/>
        <mx:HBox>
            <mx:Button icon="@Embed(source='../../../../assets/table.png')" label="Excel" click="excel()" labelPlacement="right"/>
            <mx:Button icon="@Embed(source='../../../../assets/camera.png')" label="PNG" click="png()" labelPlacement="right"/>
            <mx:Button icon="@Embed(source='../../../../assets/link.png')" label="Link" click="url()" labelPlacement="right"/>
            <mx:Button icon="@Embed(source='../../../../assets/plasma_tv.png')" label="Embed" click="embed()" labelPlacement="right"/>
            <mx:Button icon="@Embed(source='../../../../assets/uwa-netvibes.png')" click="netvibes()"/>
            <mx:Button icon="@Embed(source='../../../../assets/uwa-google.png')" click="igoogle()"/>
        </mx:HBox>
        <mx:HBox width="100%" horizontalAlign="center">
            <mx:Button label="Close" click="PopUpManager.removePopUp(this)"/>
        </mx:HBox>
    </mx:VBox>
</util:EITitleWindow>