<?xml version="1.0" encoding="utf-8"?>
<util:EITitleWindow xmlns:util="com.easyinsight.util.*" xmlns:mx="http://www.adobe.com/2006/mxml" creationComplete="dataProvider.searchForSubscribedFeeds.send()">
	<mx:Metadata>
		[Event(name="feedAdded", type="com.easyinsight.feedassembly.FeedAdditionEvent")]
	</mx:Metadata> 
	<mx:Script>
		<![CDATA[
        import com.easyinsight.administration.feed.FeedDefinitionData;

        import mx.managers.PopUpManager;

        import com.easyinsight.listing.DataFeedDescriptor;

        import mx.rpc.events.ResultEvent;
        import mx.collections.ArrayCollection;

        [Bindable]
        private var descriptors:ArrayCollection;

        private function gotFeeds(event:ResultEvent):void {
            descriptors = dataProvider.searchForSubscribedFeeds.lastResult;
        }

        private function chose():void {
            var descriptor:DataFeedDescriptor = feedBox.selectedItem as DataFeedDescriptor;
            uploadService.getDataFeedConfiguration.send(descriptor.id);
        }

        private function gotFeedDetails(event:ResultEvent):void {
            dispatchEvent(new FeedAdditionEvent(uploadService.getDataFeedConfiguration.lastResult as FeedDefinitionData));
            PopUpManager.removePopUp(this);
        }

        private function cancel():void {
            PopUpManager.removePopUp(this);
        }
		]]>
	</mx:Script>
	<mx:RemoteObject id="dataProvider" destination="feeds">
		<mx:method name="searchForSubscribedFeeds" result="gotFeeds(event)"/>
	</mx:RemoteObject>
	<mx:RemoteObject id="uploadService" destination="userUpload">
		<mx:method name="getDataFeedConfiguration" result="gotFeedDetails(event)"/>
	</mx:RemoteObject>
	<mx:Form styleName="TitleWindowContents">
		<mx:FormItem label="Choose a Feed:">
			<mx:ComboBox id="feedBox" dataProvider="{descriptors}" selectedIndex="0" labelField="name"/>		
		</mx:FormItem>
		<mx:FormItem label="" direction="horizontal">
			<mx:Button label="OK" click="chose()"/>
			<mx:Button label="Cancel" click="cancel()"/>			
		</mx:FormItem>
	</mx:Form>
	
</util:EITitleWindow>
