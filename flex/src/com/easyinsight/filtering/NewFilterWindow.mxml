<?xml version="1.0"?>
<util:EISlimWindow xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:util="com.easyinsight.util.*">
    <util:states>
        <mx:State name="advanced">
            <mx:RemoveChild target="{advancedOptionsButton}"/>
            <mx:AddChild relativeTo="{optionsBox}">
                <mx:HBox creationComplete="PopUpUtil.centerPopUp(this)">
                    <mx:RadioButton label="Create an Or Filter" groupName="typeGroup" value="orFilter"/>
                    <mx:RadioButton label="Create a Field Choice Filter" groupName="typeGroup" value="fieldChoiceFilter"/>
                    <mx:RadioButton label="Create a Named Reference Filter" groupName="typeGroup" value="namedRef"/>
                    <mx:RadioButton label="Create a Trend Filter" groupName="typeGroup" value="trendFilter"/>
                </mx:HBox>
            </mx:AddChild>
        </mx:State>
    </util:states>
    <mx:Script><![CDATA[
        import com.easyinsight.analysis.AnalysisItemWrapper;
        import com.easyinsight.util.PopUpUtil;

        import mx.collections.ArrayCollection;

        [Bindable]
        public var availableFields:ArrayCollection;

        [Bindable]
        public var advancedAvailable:Boolean = true;

        private function newFieldFilter():void {
            dispatchEvent(new NewFilterEvent(NewFilterEvent.FIELD_FILTER, AnalysisItemWrapper(fieldBox.selectedItem).analysisItem));
            this.close();
        }

        private function newOrFilter():void {
            dispatchEvent(new NewFilterEvent(NewFilterEvent.OR_FILTER));
            this.close();
        }

        private function newRefFilter():void {
            dispatchEvent(new NewFilterEvent(NewFilterEvent.NAMED_REF_FILTER));
            this.close();
        }

        private function newTrendFilter():void {
            dispatchEvent(new NewFilterEvent(NewFilterEvent.TREND_FILTER));
            this.close();
        }

        private function newFieldChoiceFilter():void {
            dispatchEvent(new NewFilterEvent(NewFilterEvent.FIELD_CHOICE_FILTER, AnalysisItemWrapper(aFieldBox.selectedItem).analysisItem));
            this.close();
        }

        [Bindable]
        private var stackIndex:int = 0;

        private function updateStack():void {
            if (typeGroup.selectedValue == "fieldFilter") {
                stackIndex = 0;
            } else if (typeGroup.selectedValue == "namedRef") {
                stackIndex = 3;
            } else if (typeGroup.selectedValue == "trendFilter") {
                stackIndex = 4;
            } else if (typeGroup.selectedValue == "fieldChoiceFilter") {
                stackIndex = 2;
            } else {
                stackIndex = 1;
            }
        }

        private function toAdvanced():void {
            currentState = "advanced";
        }
        ]]></mx:Script>
    <mx:VBox>
        <mx:RadioButtonGroup id="typeGroup" change="updateStack()" selectedValue="fieldFilter"/>
        <mx:HBox id="optionsBox">
            <mx:RadioButton label="Create a Filter on a Field" groupName="typeGroup" value="fieldFilter"/>
            <mx:LinkButton label="Show Advanced Options" click="toAdvanced()" textDecoration="underline" id="advancedOptionsButton" visible="{advancedAvailable}"/>
        </mx:HBox>
        <mx:ViewStack resizeToContent="true" selectedIndex="{stackIndex}">
            <mx:VBox>
                <mx:Label text="Choose a field for the filter:"/>
                <mx:ComboBox dataProvider="{availableFields}" id="fieldBox" labelField="displayName"/>
                <mx:HBox>
                    <util:SaveButton label="Create the Filter" click="newFieldFilter()"/>
                    <util:CancelButton label="Cancel" click="this.close()"/>
                </mx:HBox>
            </mx:VBox>
            <mx:HBox>
                <util:SaveButton label="Create a new Or Filter" click="newOrFilter()"/>
                <util:CancelButton label="Cancel" click="this.close()"/>
            </mx:HBox>
            <mx:VBox>
                <mx:Label text="Choose a field for the filter:"/>
                <mx:ComboBox dataProvider="{availableFields}" id="aFieldBox" labelField="displayName"/>
                <mx:HBox>
                    <util:SaveButton label="Create a new Field Choice Filter" click="newFieldChoiceFilter()"/>
                    <util:CancelButton label="Cancel" click="this.close()"/>
                </mx:HBox>
            </mx:VBox>
            <mx:HBox>
                <util:SaveButton label="Create a new Named Reference Filter" click="newRefFilter()"/>
                <util:CancelButton label="Cancel" click="this.close()"/>
            </mx:HBox>
            <mx:HBox>
                <util:SaveButton label="Create a new Trend Filter" click="newTrendFilter()"/>
                <util:CancelButton label="Cancel" click="this.close()"/>
            </mx:HBox>
        </mx:ViewStack>
    </mx:VBox>
</util:EISlimWindow>
