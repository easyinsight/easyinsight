<?xml version="1.0"?>
<feed:DataSourceWindow xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:util="com.easyinsight.util.*" width="800"
                       horizontalAlign="center" xmlns:feed="com.easyinsight.administration.feed.*">
    <mx:Script><![CDATA[
        import com.easyinsight.analysis.ReportFormItem;
        import com.easyinsight.analysis.StyleConfiguration;

        import com.easyinsight.util.PopUpUtil;

        import mx.collections.ArrayCollection;
        import mx.controls.Alert;
        import mx.events.FlexEvent;
        import mx.managers.PopUpManager;


        private var items:ArrayCollection;


        override protected function gotSource():void {
            super.gotSource();
            items = StyleConfiguration.getDataSourceItems(dataSource);
            var lastItem:ReportFormItem = items.getItemAt(items.length - 1) as ReportFormItem;
            lastItem.addEventListener(FlexEvent.CREATION_COMPLETE, onDone);
            for each (var item:ReportFormItem in items) {
                form.addChild(item);
            }
        }

        private function onDone(event:FlexEvent):void {
            PopUpUtil.centerPopUp(this);
        }

        private function save():void {
            var valid:Boolean = true;
            for each (var validateItem:ReportFormItem in items) {
                valid = valid && validateItem.validate();
            }
            if (valid) {
                for each (var item:ReportFormItem in items) {
                    item.save();
                }
            }
            if (dataSource.feedName == null || dataSource.feedName.length < 1) {
                Alert.show("You must configure a data source name.");
                return;
            }
            saveSource();
        }
        ]]></mx:Script>
    <mx:Box width="100%" height="100%" borderStyle="solid" borderThickness="1" borderColor="#CCCCCC" paddingLeft="5" paddingTop="5" paddingBottom="5"
            horizontalAlign="center" maxHeight="300">
        <mx:Form id="form">

        </mx:Form>
    </mx:Box>
    <mx:HBox>
        <util:SaveButton label="Save" click="save()"/>
        <util:CancelButton label="Cancel" click="PopUpManager.removePopUp(this)"/>
    </mx:HBox>
</feed:DataSourceWindow>
