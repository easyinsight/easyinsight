<?xml version="1.0" encoding="utf-8"?>
<mx:Box xmlns:mx="http://www.adobe.com/2006/mxml" creationComplete="initHandlers()">
	<mx:Script>
		<![CDATA[
        import com.easyinsight.util.PopUpUtil;

        import mx.managers.PopUpManager;
			import com.easyinsight.customupload.UploadPolicy;
			import com.easyinsight.customupload.GroupUploadPolicy;
			import mx.collections.ArrayCollection;
			[Bindable]
            private var groups:ArrayCollection = new ArrayCollection();
            
            public function set initialPolicy(uploadPolicy:UploadPolicy):void {
				if (uploadPolicy is GroupUploadPolicy) {
					var groupUploadPolicy:GroupUploadPolicy = uploadPolicy as GroupUploadPolicy;
					groups = groupUploadPolicy.groupDescriptors;
				}
			}
			
			private function initHandlers():void {
            	accessGrid.addEventListener(GroupLinkEvent.DELETE_GROUP_LINK, deleteGroup);
            }
            
            private function addAccess():void {
            	var window:AddGroupToFeedWindow = AddGroupToFeedWindow(PopUpManager.createPopUp(this.parent.parent, AddGroupToFeedWindow, true));
            	window.addEventListener(GroupLinkEvent.ADD_GROUP_LINK, addUser);
            	PopUpUtil.centerPopUp(window);
            }
            
            private function addUser(event:GroupLinkEvent):void {
            	groups.addItem(event.groupDescriptor);
            }
            
            private function deleteGroup(event:GroupLinkEvent):void {
            	var index:int = groups.getItemIndex(event.groupDescriptor);
            	groups.removeItemAt(index);
            }
            
            public function createPolicy():UploadPolicy {
				var groupPolicy:GroupUploadPolicy = new GroupUploadPolicy();
				groupPolicy.groupDescriptors = this.groups;
				return groupPolicy;
			}
		]]>
	</mx:Script>
	<mx:HBox>
		<mx:Button label="Add Group Access..." click="addAccess()"/>
	</mx:HBox>
	<mx:DataGrid id="accessGrid" dataProvider="{groups}">
		<mx:columns>
			<mx:DataGridColumn headerText="Group" dataField="groupName"/>
			<mx:DataGridColumn headerText="" dataField="groupName" width="64"
				itemRenderer="com.easyinsight.administration.feed.DeleteGroupButton"/>
		</mx:columns>
	</mx:DataGrid>
</mx:Box>
