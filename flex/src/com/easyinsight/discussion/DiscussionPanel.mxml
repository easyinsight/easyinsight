<?xml version="1.0" ?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" verticalGap="0">
    <mx:Script><![CDATA[
import com.easyinsight.groups.GroupAuditMessage;
        import mx.events.FlexEvent;
        import mx.collections.ArrayCollection;
        import mx.collections.IHierarchicalCollectionView;
        private var _dataProvider:ArrayCollection;

        private var _topBarColor:uint;
        private var _controlBarColor:uint;

        private var keyword:String;

        override protected function commitProperties():void {
            super.commitProperties();
            endDate.selectedDate = new Date();
            startDate.selectedDate = new Date(endDate.selectedDate.getTime() - (24 * 60 * 60 * 1000 * 7));

        }

        private function filterFields():void {
            keyword = keywordInput.text.toLowerCase();
            messageGrid.dataProvider.filterFunction = filterFunction;            
            messageGrid.dataProvider.refresh();
        }

        private function filterFunction(item:Object):Boolean {
            if (item.timestamp < startDate.selectedDate || item.timestamp > endDate.selectedDate) {
                return false;
            }
            if (filterBox.selectedItem != "All") {
                if (filterBox.selectedItem == "Comments" && item.audit) {
                    return false;
                } else if (filterBox.selectedItem == "Audit" && !item.audit) {
                    return false;
                }
            }
            if (keyword != null && keyword.length > 0) {
                return (item.message.toLowerCase().indexOf(keyword) == -1);
            }
            return true;
        }

        [Bindable]
        public function get dataProvider():ArrayCollection {
            return _dataProvider;
        }
        public function set dataProvider(val:ArrayCollection):void {
            _dataProvider = val;
            dispatchEvent(new FlexEvent(FlexEvent.DATA_CHANGE));
        }

        private function blah():void {
            new GroupAuditMessage();
        }


        ]]></mx:Script>
    <mx:Box width="100%" height="5" backgroundColor="#D42525" left="0" right="0"/>
    <mx:HBox width="100%" backgroundColor="#F6A76B" horizontalAlign="center">
        <mx:ComboBox id="filterBox" change="filterFields()">
            <mx:dataProvider>
                <mx:Array>
                    <mx:String>All</mx:String>
                    <mx:String>Comments</mx:String>
                    <mx:String>Audit</mx:String>
                </mx:Array>
            </mx:dataProvider>
        </mx:ComboBox>
        <mx:Label fontSize="12" text="Between"/>
        <mx:DateField id="startDate" change="filterFields()"/>
        <mx:Label fontSize="12" text="and"/>
        <mx:DateField id="endDate" change="filterFields()"/>
        <mx:Label text="Keyword:"/>
        <mx:TextInput id="keywordInput" keyUp="filterFields()"/>
    </mx:HBox>
    <mx:DataGrid dataProvider="{dataProvider}" id="messageGrid" width="100%">
        <mx:columns>
            <mx:DataGridColumn headerText="User" dataField="userName" width="130" headerRenderer="com.easyinsight.groups.CustomGroupHeader"/>
            <mx:DataGridColumn headerText="When" dataField="timestamp" width="130" headerRenderer="com.easyinsight.groups.CustomGroupHeader"/>
            <mx:DataGridColumn headerText="Message" dataField="message" headerRenderer="com.easyinsight.groups.CustomGroupHeader"
                    itemRenderer="com.easyinsight.discussion.DiscussionMessageRenderer"/>
        </mx:columns>
    </mx:DataGrid>
</mx:VBox>